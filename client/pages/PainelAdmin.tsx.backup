import { useState, useEffect } from "react";
import { Link, useNavigate } from "react-router-dom";
import { useAuth } from "@/context/AuthContext";
import { useLogo } from "@/context/LogoContext";
import {
  BarChart,
  PieChart,
  LayoutDashboard,
  Package,
  FileText,
  Settings,
  DollarSign,
  TrendingUp,
  AlertTriangle,
  Download,
  Upload,
  Edit,
  Users,
  Calendar,
  QrCode,
  Star,
  Palette,
  Monitor,
  Filter,
  Search,
  Bell,
  Shield,
  Eye,
  CheckCircle,
  XCircle,
  Clock,
  Trash2,
  Plus,
  ArrowRight,
  Camera,
  Clapperboard,
  Mic,
  Lightbulb,
  X,
  Phone,
  Tag,
  Folder,
  Calculator,
  Edit3,
  MapPin,
  Activity,
} from "lucide-react";

// UI Components
import { Button } from "@/components/ui/button";
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card";
import { Badge } from "@/components/ui/badge";
import { Input } from "@/components/ui/input";
import { Label } from "@/components/ui/label";
import { Separator } from "@/components/ui/separator";
import Layout from "@/components/Layout";
import { AdvancedPageEditor } from "@/components/AdvancedPageEditor";
import FinancialERP from "@/components/FinancialERP";
import { ImportManager } from "@/components/ImportManager";
import MultiTenantPlaceholder from "@/components/MultiTenantPlaceholder";
import TemplateManager from "@/components/TemplateManager";
import CompanySettings from "@/components/CompanySettings";
import ColorSettings from "@/components/ColorSettings";
import { ClientAreaManager } from "@/components/ClientAreaManager";
import { ProductSelectionModal } from "@/components/ProductSelectionModal";
import { ProductManager } from "@/components/ProductManager";
import { CategoryManager } from "@/components/CategoryManager";
import { DashboardCharts } from "@/components/DashboardCharts";
import { useInlineEditor } from "@/components/InlineEditor";
import { AutoTimesheetSystem } from "@/components/AutoTimesheetSystem";
import { ManagerActivityDashboard } from "@/components/ManagerActivityDashboard";
import { EmployeeManager } from "@/components/EmployeeManager";

// Equipment list for autocomplete
const availableEquipment = [
  "Sony FX6 Full Frame",
  "Canon EOS R5C",
  "Blackmagic URSA Mini Pro 12K",
  "Arri Alexa Mini LF",
  "Red Komodo 6K",
  "Zeiss CP.3 85mm T2.1",
  "Canon CN-E 50mm T1.3",
  "Cooke S4/i 35mm",
  'Atomos Ninja V 5"',
  "SmallHD 702 Touch",
  "Sound Devices MixPre-6",
  "DJI Ronin 4D",
  "Moza Air 2",
  "Tilta Nucleus-M",
  "Teradek Bolt 4K LT",
  "Hollyland Mars 400S Pro",
  "ARRI SkyPanel S30-C",
  "Aputure 300X",
  "Godox VL150",
];

// Mock data para demonstração
const dashboardMetrics = {
  equipmentAvailable: 47,
  activeOrders: 12,
  monthlyRevenue: 45600.0,
  maintenanceAlerts: 3,
};

const recentOrders = [
  {
    id: "ORD-2025-001",
    client: "João Silva",
    items: ["Sony FX6", "Zeiss CP.3 85mm"],
    total: 1200.0,
    status: "em locação",
    date: "2025-01-15",
  },
  {
    id: "ORD-2025-002",
    client: "Maria Santos",
    items: ["Canon R5C", "Monitor Atomos"],
    total: 850.0,
    status: "concluído",
    date: "2025-01-14",
  },
  {
    id: "ORD-2025-003",
    client: "Pedro Costa",
    items: ["Blackmagic URSA Mini Pro"],
    total: 450.0,
    status: "ativo",
    date: "2025-01-13",
  },
  {
    id: "ORD-2025-004",
    client: "Ana Oliveira",
    items: ["DJI Ronin 4D", "SmallHD Monitor"],
    total: 680.0,
    status: "em locação",
    date: "2025-01-12",
  },
];

const equipmentStock = [
  { name: "Sony FX6 Full Frame", available: 3, total: 5, category: "Câmeras" },
  { name: "Canon EOS R5C", available: 2, total: 4, category: "Câmeras" },
  { name: "Zeiss CP.3 85mm", available: 1, total: 3, category: "Lentes" },
  { name: "Atomos Ninja V", available: 4, total: 6, category: "Monitores" },
  { name: "DJI Ronin 4D", available: 0, total: 2, category: "Estabilizadores" },
];

const maintenanceAlerts = [
  {
    equipment: "Sony FX6 #003",
    issue: "Limpeza de sensor necessária",
    priority: "média",
  },
  {
    equipment: "Canon R5C #002",
    issue: "Bateria com baixa duração",
    priority: "alta",
  },
  {
    equipment: "Ronin 4D #001",
    issue: "Calibração de gimbal",
    priority: "baixa",
  },
];

const clientsData = [
  {
    id: "CLI-001",
    name: "João Silva",
    email: "joao.silva@email.com",
    phone: "(31) 99999-9999",
    type: "cliente",
    company: "",
    totalOrders: 5,
    lastOrder: "2025-01-15",
  },
  {
    id: "CLI-002",
    name: "Maria Santos",
    email: "maria@produtora.com",
    phone: "(31) 98888-8888",
    type: "ambos",
    company: "Produtora Santos",
    totalOrders: 12,
    lastOrder: "2025-01-10",
  },
  {
    id: "FOR-003",
    name: "Pedro Costa",
    email: "pedro@equipamentos.com",
    phone: "(31) 97777-7777",
    type: "fornecedor",
    company: "Equipamentos Costa",
    totalOrders: 0,
    lastOrder: "-",
  },
  {
    id: "CLI-004",
    name: "Ana Oliveira",
    email: "ana@filmestudio.com",
    phone: "(31) 96666-6666",
    type: "cliente",
    company: "Filme Studio",
    totalOrders: 8,
    lastOrder: "2025-01-08",
  },
];

const servicesData = [
  {
    id: "SRV-001",
    name: "Gravação de Eventos",
    description: "Gravação profissional de eventos corporativos e sociais",
    price: 800.0,
    duration: "4 horas",
    category: "Gravação",
    active: true,
  },
  {
    id: "SRV-002",
    name: "Produç��o de Vídeo Corporativo",
    description: "Produção completa de vídeos institucionais",
    price: 2500.0,
    duration: "1-3 dias",
    category: "Produção",
    active: true,
  },
  {
    id: "SRV-003",
    name: "Edição e Pós-Produção",
    description: "Edição profissional e finalização de vídeos",
    price: 150.0,
    duration: "Por hora",
    category: "Pós-Produção",
    active: true,
  },
  {
    id: "SRV-004",
    name: "Live Streaming",
    description: "Transmissão ao vivo de eventos",
    price: 1200.0,
    duration: "Por evento",
    category: "Streaming",
    active: false,
  },
];

export default function PainelAdmin() {
  const [activeTab, setActiveTab] = useState("dashboard");
  const [searchTerm, setSearchTerm] = useState("");
  const [filterStatus, setFilterStatus] = useState("todos");
  const { state: editorState, toggleEditor } = useInlineEditor();
  const [showNewOrderModal, setShowNewOrderModal] = useState(false);
  const [nextOrderNumber, setNextOrderNumber] = useState("000001");
  const [newOrderForm, setNewOrderForm] = useState({
    orderNumber: "000001",
    quoteNumber: "",
    quoteDate: "",
    issueDate: new Date().toISOString().split("T")[0],
    issueTime: new Date().toTimeString().slice(0, 5),
    status: "Orcamento",
    priority: "Normal",
    salesperson: "",
    origin: "Balcao",
    clientName: "",
    clientEmail: "",
    clientPhone: "",
    clientCNPJ: "",
    clientAddress: "",
    clientCity: "",
    projectName: "",
    director: "",
    producer: "",
    deliveryType: "Retirada",
    carrier: "",
    deliveryAddress: "",
    pickupDate: "",
    returnDate: "",
    pickupTime: "",
    returnTime: "",
    rentalDays: 1,
    subtotal: 0,
    discount: 0,
    discountType: "percentage",
    discountValue: 0,
    discountGeneralType: "percentage",
    total: 0,
    paymentCondition: "A vista",
    paymentMethod: "Dinheiro",
    equipment: [],
    notes: "",
    internalNotes: "",
  });
  const [equipmentSearchTerm, setEquipmentSearchTerm] = useState("");
  const [showEquipmentSuggestions, setShowEquipmentSuggestions] =
    useState(false);
  const [clientSearchTerm, setClientSearchTerm] = useState("");
  const [showClientSuggestions, setShowClientSuggestions] = useState(false);
  const [showClientModal, setShowClientModal] = useState(false);
  const [showServiceModal, setShowServiceModal] = useState(false);
  const [showEditorModal, setShowEditorModal] = useState(false);
  const [showViewOrderModal, setShowViewOrderModal] = useState(false);
  const [selectedOrder, setSelectedOrder] = useState<any>(null);
  const [clientForm, setClientForm] = useState({
    name: "",
    email: "",
    phone: "",
    type: "cliente",
    company: "",
  });
  const [serviceForm, setServiceForm] = useState({
    name: "",
    description: "",
    price: "",
    duration: "",
    category: "Gravação",
  });

  // Stock management state
  const [stockData, setStockData] = useState([
    {
      id: 1,
      name: "Sony FX6 Full Frame",
      code: "SFX6-001",
      category: "Câmeras",
      brand: "Sony",
      type: "individual",
      available: 3,
      total: 5,
      reserved: 2,
      price: 450.0,
      isKit: false,
      kitItems: [],
    },
    {
      id: 2,
      name: "Canon EOS R5C",
      code: "CER5-001",
      category: "Câmeras",
      brand: "Canon",
      type: "individual",
      available: 2,
      total: 4,
      reserved: 2,
      price: 380.0,
      isKit: false,
      kitItems: [],
    },
    {
      id: 3,
      name: "Zeiss CP.3 85mm",
      code: "ZCP3-85",
      category: "Lentes",
      brand: "Zeiss",
      type: "individual",
      available: 1,
      total: 3,
      reserved: 2,
      price: 120.0,
      isKit: false,
      kitItems: [],
    },
    {
      id: 4,
      name: "Atomos Ninja V",
      code: "ANV5-001",
      category: "Monitores",
      brand: "Atomos",
      type: "individual",
      available: 4,
      total: 6,
      reserved: 2,
      price: 85.0,
      isKit: false,
      kitItems: [],
    },
    {
      id: 5,
      name: "DJI Ronin 4D",
      code: "DR4D-001",
      category: "Estabilizadores",
      brand: "DJI",
      type: "individual",
      available: 0,
      total: 2,
      reserved: 2,
      price: 280.0,
      isKit: false,
      kitItems: [],
    },
    {
      id: 6,
      name: "SmallHD Monitor",
      code: "SHD7-001",
      category: "Monitores",
      brand: "SmallHD",
      type: "individual",
      available: 3,
      total: 5,
      reserved: 2,
      price: 95.0,
      isKit: false,
      kitItems: [],
    },
    {
      id: 7,
      name: "Blackmagic URSA Mini Pro",
      code: "BUMP-001",
      category: "Câmeras",
      brand: "Blackmagic",
      type: "individual",
      available: 1,
      total: 2,
      reserved: 1,
      price: 520.0,
      isKit: false,
      kitItems: [],
    },
    {
      id: 8,
      name: "Kit Filmagem Completo",
      code: "KIT-001",
      category: "Kits",
      brand: "Diversos",
      type: "kit",
      available: 2,
      total: 3,
      reserved: 1,
      price: 850.0,
      isKit: true,
      kitItems: [
        "Sony FX6 Full Frame",
        "Zeiss CP.3 85mm",
        "Atomos Ninja V",
        "DJI Ronin 4D",
      ],
    },
    {
      id: 9,
      name: "Kit Iniciante",
      code: "KIT-002",
      category: "Kits",
      brand: "Diversos",
      type: "kit",
      available: 3,
      total: 4,
      reserved: 1,
      price: 420.0,
      isKit: true,
      kitItems: ["Canon EOS R5C", "SmallHD Monitor"],
    },
    {
      id: 10,
      name: "Kit Documentário",
      code: "KIT-003",
      category: "Kits",
      brand: "Diversos",
      type: "kit",
      available: 1,
      total: 2,
      reserved: 1,
      price: 680.0,
      isKit: true,
      kitItems: [
        "Blackmagic URSA Mini Pro",
        "Zeiss CP.3 85mm",
        "SmallHD Monitor",
      ],
    },
  ]);

  // Stock search and filtering state
  const [stockSearch, setStockSearch] = useState("");
  const [stockCategoryFilter, setStockCategoryFilter] = useState("todos");
  const [stockTypeFilter, setStockTypeFilter] = useState("todos");
  const [stockStatusFilter, setStockStatusFilter] = useState("todos");
  const [stockSort, setStockSort] = useState("name");
  const [stockView, setStockView] = useState<"grid" | "list">("grid");
  const [currentPage, setCurrentPage] = useState(1);
  const itemsPerPage = 12;
  const [showProductSelectionModal, setShowProductSelectionModal] =
    useState(false);
  const [activeSettingsTab, setActiveSettingsTab] = useState("geral");
  const [currentBanner, setCurrentBanner] = useState("");
  const [logoFileInput, setLogoFileInput] = useState<HTMLInputElement | null>(
    null,
  );
  const [bannerFileInput, setBannerFileInput] =
    useState<HTMLInputElement | null>(null);
  const { currentLogo, updateLogo } = useLogo();

  const { user, isAuthenticated, isAdmin, isFuncionario } = useAuth();
  const navigate = useNavigate();

  // Redirect if not authenticated or not admin
  useEffect(() => {
    // Only redirect if we have confirmed authentication state and we're not already on the target page
    if (isAuthenticated === false && window.location.pathname !== "/login") {
      navigate("/login", { replace: true });
    } else if (isAuthenticated === true && !(isAdmin || isFuncionario) && window.location.pathname !== "/area-cliente") {
      // Redirect users without admin or funcionario roles to client area
      navigate("/area-cliente", { replace: true });
    }
  }, [isAuthenticated, isAdmin, isFuncionario, navigate]);

  // Show loading or redirect if not authenticated or not authorized
  if (!isAuthenticated || !(isAdmin || isFuncionario) || !user) {
    return (
      <Layout>
        <div className="min-h-screen bg-cinema-dark flex items-center justify-center">
          <div className="text-center">
            <div className="text-white text-xl mb-4">
              {!isAuthenticated
                ? "Redirecionando para login..."
                : "Acesso negado - Redirecionando para área do cliente..."}
            </div>
            {!isAuthenticated && (
              <p className="text-gray-400 text-sm">
                Você precisa fazer login para acessar esta área
              </p>
            )}
            {isAuthenticated && !(isAdmin || isFuncionario) && (
              <p className="text-gray-400 text-sm">
                Esta área é restrita a administradores ou funcionários
                autorizados
              </p>
            )}
          </div>
        </div>
      </Layout>
    );
  }

  const getStatusColor = (status: string) => {
    switch (status) {
      case "ativo":
        return "text-green-400";
      case "em locação":
        return "text-blue-400";
      case "concluído":
        return "text-gray-400";
      case "atrasado":
        return "text-red-400";
      default:
        return "text-gray-400";
    }
  };

  const getStatusIcon = (status: string) => {
    switch (status) {
      case "ativo":
        return <Clock className="w-4 h-4" />;
      case "em locação":
        return <ArrowRight className="w-4 h-4" />;
      case "concluído":
        return <CheckCircle className="w-4 h-4" />;
      case "atrasado":
        return <AlertTriangle className="w-4 h-4" />;
      default:
        return <Clock className="w-4 h-4" />;
    }
  };

  const getPriorityColor = (priority: string) => {
    switch (priority) {
      case "alta":
        return "text-red-400";
      case "média":
        return "text-yellow-400";
      case "baixa":
        return "text-green-400";
      default:
        return "text-gray-400";
    }
  };

  const handleNewOrderSubmit = (e: React.FormEvent) => {
    e.preventDefault();

    // Mock: Create new order (in real app, this would be an API call)
    const newOrder = {
      id: `ORD-${newOrderForm.orderNumber}`,
      client: newOrderForm.clientName,
      items: [newOrderForm.equipment],
      total: 0, // Would be calculated based on equipment and duration
      status: "ativo",
      date: new Date().toISOString().split("T")[0],
      email: newOrderForm.clientEmail,
      phone: newOrderForm.clientPhone,
      pickupDate: newOrderForm.pickupDate,
      returnDate: newOrderForm.returnDate,
      pickupTime: newOrderForm.pickupTime,
      returnTime: newOrderForm.returnTime,
      notes: newOrderForm.notes,
    };

    // Add to orders list (this would normally update the backend)
    console.log("New order created:", newOrder);

    // Generate next order number for future orders
    const nextNum = generateNextOrderNumber();

    // Reset form and close modal
    setNewOrderForm({
      orderNumber: nextNum,
      quoteNumber: "",
      quoteDate: "",
      issueDate: new Date().toISOString().split("T")[0],
      issueTime: new Date().toTimeString().slice(0, 5),
      status: "Orcamento",
      priority: "Normal",
      salesperson: "",
      origin: "Balcao",
      clientName: "",
      clientEmail: "",
      clientPhone: "",
      clientCNPJ: "",
      clientAddress: "",
      clientCity: "",

      clientZipCode: "",
      clientType: "Pessoa Fisica",
      clientCompany: "",
      projectName: "",
      director: "",
      producer: "",
      equipment: [],
      pickupDate: "",
      returnDate: "",
      pickupTime: "",
      returnTime: "",
      notes: "",
      subtotal: 0,
      discount: 0,
      total: 0,
      internalNotes: "",
    });
    setEquipmentSearchTerm("");
    setClientSearchTerm("");
    setShowEquipmentSuggestions(false);
    setShowClientSuggestions(false);
    setShowNewOrderModal(false);

    // Show success message
    alert(`Pedido ${newOrder.id} criado com sucesso!`);
  };

  const handleFormChange = (field: string, value: string) => {
    setNewOrderForm((prev) => ({
      ...prev,
      [field]: value,
    }));
  };

  const handleEquipmentSearch = (value: string) => {
    setEquipmentSearchTerm(value);
    handleFormChange("equipment", value);
    setShowEquipmentSuggestions(value.length > 0);
  };

  const selectEquipment = (equipment: string) => {
    setEquipmentSearchTerm(equipment);
    handleFormChange("equipment", equipment);
    setShowEquipmentSuggestions(false);
  };

  const filteredEquipment = availableEquipment
    .filter((item) =>
      item.toLowerCase().includes(equipmentSearchTerm.toLowerCase()),
    )
    .slice(0, 5);

  const handleClientSearch = (value: string) => {
    setClientSearchTerm(value);
    handleFormChange("clientName", value);
    setShowClientSuggestions(value.length > 0);
  };

  const selectClient = (client: any) => {
    setClientSearchTerm(client.name);
    setNewOrderForm((prev) => ({
      ...prev,
      clientName: client.name,
      clientEmail: client.email,
      clientPhone: client.phone,
    }));
    setShowClientSuggestions(false);
  };

  const filteredClients = clientsData
    .filter(
      (client) =>
        client.name.toLowerCase().includes(clientSearchTerm.toLowerCase()) ||
        client.email.toLowerCase().includes(clientSearchTerm.toLowerCase()),
    )
    .slice(0, 5);

  const generateNextOrderNumber = () => {
    const current = parseInt(nextOrderNumber);
    const next = (current + 1).toString().padStart(6, "0");
    setNextOrderNumber(next);
    return next;
  };

  const viewOrder = (order: any) => {
    setSelectedOrder(order);
    setShowViewOrderModal(true);
  };

  const handleCheckoutOrder = (orderId: string) => {
    // Encontrar o pedido
    const order = recentOrders.find((o) => o.id === orderId);
    if (!order) return;

    // Processar estoque - dar saída
    processOrderStock(order, "checkout");

    // Update order status to "em locação" (rented)
    const updatedOrders = recentOrders.map((order) =>
      order.id === orderId ? { ...order, status: "em locação" } : order,
    );

    // Update selectedOrder if it's the current one
    if (selectedOrder && selectedOrder.id === orderId) {
      setSelectedOrder({ ...selectedOrder, status: "em locação" });
    }

    // In a real app, this would be an API call
    console.log(`Order ${orderId} status changed to: em locação`);
    console.log("Stock updated - items checked out");

    alert(
      `✅ Saída realizada com sucesso!\n\n` +
        `Pedido ${orderId} agora está EM LOCAÇÃO\n` +
        `Estoque atualizado automaticamente\n` +
        `Equipamentos foram dados baixa no estoque`,
    );
  };

  const handleReturnOrder = (orderId: string) => {
    // Encontrar o pedido
    const order = recentOrders.find((o) => o.id === orderId);
    if (!order) return;

    // Processar estoque - devolução
    processOrderStock(order, "return");

    // Update order status to "concluído" (completed)
    const updatedOrders = recentOrders.map((order) =>
      order.id === orderId ? { ...order, status: "concluído" } : order,
    );

    // Update selectedOrder if it's the current one
    if (selectedOrder && selectedOrder.id === orderId) {
      setSelectedOrder({ ...selectedOrder, status: "concluído" });
    }

    // In a real app, this would be an API call
    console.log(`Order ${orderId} status changed to: concluído`);
    console.log("Stock updated - items returned");

    alert(
      `✅ Devolução realizada com sucesso!\n\n` +
        `Pedido ${orderId} foi CONCLUÍDO\n` +
        `Estoque atualizado automaticamente\n` +
        `Equipamentos voltaram para o estoque disponível`,
    );
  };

  const handleClientSubmit = (e: React.FormEvent) => {
    e.preventDefault();
    // Mock: Create new client (in real app, this would be an API call)
    const newClient = {
      id: `CLI-${String(Math.floor(Math.random() * 1000)).padStart(3, "0")}`,
      ...clientForm,
      totalOrders: 0,
      lastOrder: "-",
    };
    console.log("New client created:", newClient);

    // Reset form and close modal
    setClientForm({
      name: "",
      email: "",
      phone: "",
      type: "cliente",
      company: "",
    });
    setShowClientModal(false);
    alert(`Cliente ${newClient.name} cadastrado com sucesso!`);
  };

  const handleServiceSubmit = (e: React.FormEvent) => {
    e.preventDefault();
    // Mock: Create new service (in real app, this would be an API call)
    const newService = {
      id: `SRV-${String(Math.floor(Math.random() * 1000)).padStart(3, "0")}`,
      ...serviceForm,
      price: parseFloat(serviceForm.price),
      active: true,
    };
    console.log("New service created:", newService);

    // Reset form and close modal
    setServiceForm({
      name: "",
      description: "",
      price: "",
      duration: "",
      category: "Gravação",
    });
    setShowServiceModal(false);
    alert(`Serviço ${newService.name} cadastrado com sucesso!`);
  };

  const handleClientFormChange = (field: string, value: string) => {
    setClientForm((prev) => ({
      ...prev,
      [field]: value,
    }));
  };

  const handleServiceFormChange = (field: string, value: string) => {
    setServiceForm((prev) => ({
      ...prev,
      [field]: value,
    }));
  };

  // Automatic stock management functions
  const updateStock = (
    equipmentName: string,
    quantity: number,
    operation: "checkout" | "return",
  ) => {
    setStockData((prevStock) =>
      prevStock.map((item) => {
        if (item.name === equipmentName) {
          if (operation === "checkout") {
            // Dar saída - diminui disponível, aumenta reservado
            return {
              ...item,
              available: Math.max(0, item.available - quantity),
              reserved: item.reserved + quantity,
            };
          } else {
            // Devolução - aumenta disponível, diminui reservado
            return {
              ...item,
              available: Math.min(item.total, item.available + quantity),
              reserved: Math.max(0, item.reserved - quantity),
            };
          }
        }
        return item;
      }),
    );
  };

  const processOrderStock = (order: any, operation: "checkout" | "return") => {
    // Processar cada item do pedido para atualizar estoque
    if (order.items && Array.isArray(order.items)) {
      order.items.forEach((itemName: string) => {
        updateStock(itemName, 1, operation); // Assumindo quantidade 1 por enquanto
      });
    }

    // Se o pedido tem equipment array (novo formato)
    if (order.equipment && Array.isArray(order.equipment)) {
      order.equipment.forEach((item: any) => {
        if (item.name && item.quantity) {
          updateStock(item.name, item.quantity, operation);
        }
      });
    }
  };

  // Stock filtering and search functions
  const getFilteredStock = () => {
    let filtered = stockData.filter((item) => {
      // Search filter
      const searchMatch =
        item.name.toLowerCase().includes(stockSearch.toLowerCase()) ||
        item.code.toLowerCase().includes(stockSearch.toLowerCase()) ||
        item.brand.toLowerCase().includes(stockSearch.toLowerCase());

      // Category filter
      const categoryMatch =
        stockCategoryFilter === "todos" ||
        item.category === stockCategoryFilter;

      // Type filter (kit vs individual)
      const typeMatch =
        stockTypeFilter === "todos" || item.type === stockTypeFilter;

      // Status filter
      let statusMatch = true;
      if (stockStatusFilter === "disponivel") statusMatch = item.available > 0;
      else if (stockStatusFilter === "indisponivel")
        statusMatch = item.available === 0;
      else if (stockStatusFilter === "em_locacao")
        statusMatch = item.reserved > 0;

      return searchMatch && categoryMatch && typeMatch && statusMatch;
    });

    // Sorting
    filtered.sort((a, b) => {
      switch (stockSort) {
        case "name":
          return a.name.localeCompare(b.name);
        case "code":
          return a.code.localeCompare(b.code);
        case "category":
          return a.category.localeCompare(b.category);
        case "available":
          return b.available - a.available;
        case "price":
          return b.price - a.price;
        default:
          return 0;
      }
    });

    return filtered;
  };

  const getPaginatedStock = () => {
    const filtered = getFilteredStock();
    const startIndex = (currentPage - 1) * itemsPerPage;
    const endIndex = startIndex + itemsPerPage;
    return filtered.slice(startIndex, endIndex);
  };

  const getTotalPages = () => {
    return Math.ceil(getFilteredStock().length / itemsPerPage);
  };

  const getUniqueCategories = () => {
    return [...new Set(stockData.map((item) => item.category))];
  };

  // Handle logo upload
  const handleLogoUpload = () => {
    if (!logoFileInput) {
      const input = document.createElement("input");
      input.type = "file";
      input.accept = "image/*";
      input.onchange = (event) => {
        const file = (event.target as HTMLInputElement).files?.[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = (e) => {
            const result = e.target?.result as string;
            updateLogo(result); // Update global logo
            alert("Logo atualizado com sucesso! Mudou em todo o sistema.");
          };
          reader.readAsDataURL(file);
        }
      };
      setLogoFileInput(input);
      input.click();
    } else {
      logoFileInput.click();
    }
  };

  // Handle banner upload
  const handleBannerUpload = () => {
    if (!bannerFileInput) {
      const input = document.createElement("input");
      input.type = "file";
      input.accept = "image/*";
      input.onchange = (event) => {
        const file = (event.target as HTMLInputElement).files?.[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = (e) => {
            const result = e.target?.result as string;
            setCurrentBanner(result);
            // In a real app, you would upload this to your server
            alert("Banner atualizado com sucesso!");
          };
          reader.readAsDataURL(file);
        }
      };
      setBannerFileInput(input);
      input.click();
    } else {
      bannerFileInput.click();
    }
  };

  // Handle product selection from modal
  const handleProductSelection = (selectedProducts: any[]) => {
    const formattedEquipment = selectedProducts.map((product) => ({
      id: product.id,
      code: product.code,
      name: product.name,
      quantity: product.quantity,
      unitPrice: product.price,
      days: product.days,
      discount: product.discount,
      total:
        product.price *
        product.quantity *
        product.days *
        (1 - product.discount / 100),
    }));

    const currentEquipment = newOrderForm.equipment || [];
    const newEquipmentList = [...currentEquipment, ...formattedEquipment];

    // Calculate subtotal
    const subtotal = newEquipmentList.reduce((sum, item) => {
      return (
        sum +
        (item.unitPrice || 0) *
          (item.quantity || 1) *
          (item.days || 1) *
          (1 - (item.discount || 0) / 100)
      );
    }, 0);

    // Update form state directly
    setNewOrderForm((prev) => ({
      ...prev,
      equipment: newEquipmentList,
      subtotal: subtotal,
      total: subtotal - (prev.discount || 0),
    }));

    // Close modal
    setShowProductSelectionModal(false);
  };

  // Calculate order totals with general discount
  const updateOrderTotals = (equipmentList: any[] = newOrderForm.equipment) => {
    const subtotal = equipmentList.reduce((sum, item) => {
      return (
        sum +
        (item.unitPrice || 0) *
          (item.quantity || 1) *
          (item.days || 1) *
          (1 - (item.discount || 0) / 100)
      );
    }, 0);

    let discountAmount = 0;
    const discountValue = newOrderForm.discountValue || 0;
    const discountType = newOrderForm.discountGeneralType || "percentage";

    if (discountType === "percentage") {
      discountAmount = subtotal * (discountValue / 100);
    } else {
      discountAmount = discountValue;
    }

    const total = subtotal - discountAmount;

    setNewOrderForm((prev) => ({
      ...prev,
      subtotal: subtotal,
      discount: discountAmount,
      total: Math.max(0, total),
    }));
  };

  return (
    <Layout>
      <div className="min-h-screen bg-cinema-dark">
        <div className="flex">
          {/* Sidebar */}
          <div className="w-64 bg-cinema-gray border-r border-cinema-gray-light min-h-screen sticky top-0">
            <div className="p-6">
              <h1 className="text-xl font-bold text-cinema-yellow mb-8" data-edit-id="sidebar.title">
                Painel da Locadora
              </h1>

              <nav className="space-y-2">
                <Button
                  variant={activeTab === "dashboard" ? "default" : "ghost"}
                  className={`w-full justify-start ${
                    activeTab === "dashboard"
                      ? "bg-cinema-yellow text-cinema-dark"
                      : "text-white hover:text-cinema-yellow"
                  }`}
                  onClick={() => setActiveTab("dashboard")}
                  data-edit-id="sidebar.dashboard-button"
                >
                  <LayoutDashboard className="w-4 h-4 mr-2" />
                  <span data-edit-id="sidebar.dashboard-text">Dashboard</span>
                </Button>

                <Button
                  variant={activeTab === "pedidos" ? "default" : "ghost"}
                  className={`w-full justify-start ${
                    activeTab === "pedidos"
                      ? "bg-cinema-yellow text-cinema-dark"
                      : "text-white hover:text-cinema-yellow"
                  }`}
                  onClick={() => setActiveTab("pedidos")}
                  data-edit-id="sidebar.pedidos-button"
                >
                  <Package className="w-4 h-4 mr-2" />
                  <span data-edit-id="sidebar.pedidos-text">Pedidos</span>
                </Button>

                <Button
                  variant={activeTab === "estoque" ? "default" : "ghost"}
                  className={`w-full justify-start ${
                    activeTab === "estoque"
                      ? "bg-cinema-yellow text-cinema-dark"
                      : "text-white hover:text-cinema-yellow"
                  }`}
                  onClick={() => setActiveTab("estoque")}
                  data-edit-id="sidebar.estoque-button"
                >
                  <Package className="w-4 h-4 mr-2" />
                  <span data-edit-id="sidebar.estoque-text">Estoque</span>
                </Button>

                <Button
                  variant={activeTab === "produtos" ? "default" : "ghost"}
                  className={`w-full justify-start ${
                    activeTab === "produtos"
                      ? "bg-cinema-yellow text-cinema-dark"
                      : "text-white hover:text-cinema-yellow"
                  }`}
                  onClick={() => setActiveTab("produtos")}
                >
                  <Package className="w-4 h-4 mr-2" />
                  Produtos
                </Button>

                <Button
                  variant={activeTab === "categorias" ? "default" : "ghost"}
                  className={`w-full justify-start ${
                    activeTab === "categorias"
                      ? "bg-cinema-yellow text-cinema-dark"
                      : "text-white hover:text-cinema-yellow"
                  }`}
                  onClick={() => setActiveTab("categorias")}
                >
                  <Filter className="w-4 h-4 mr-2" />
                  Categorias
                </Button>

                <Button
                  variant={activeTab === "clientes" ? "default" : "ghost"}
                  className={`w-full justify-start ${
                    activeTab === "clientes"
                      ? "bg-cinema-yellow text-cinema-dark"
                      : "text-white hover:text-cinema-yellow"
                  }`}
                  onClick={() => setActiveTab("clientes")}
                >
                  <Users className="w-4 h-4 mr-2" />
                  Clientes/Fornecedores
                </Button>

                <Button
                  variant={activeTab === "servicos" ? "default" : "ghost"}
                  className={`w-full justify-start ${
                    activeTab === "servicos"
                      ? "bg-cinema-yellow text-cinema-dark"
                      : "text-white hover:text-cinema-yellow"
                  }`}
                  onClick={() => setActiveTab("servicos")}
                >
                  <Clapperboard className="w-4 h-4 mr-2" />
                  Serviços
                </Button>

                <Button
                  variant={activeTab === "documentos" ? "default" : "ghost"}
                  className={`w-full justify-start ${
                    activeTab === "documentos"
                      ? "bg-cinema-yellow text-cinema-dark"
                      : "text-white hover:text-cinema-yellow"
                  }`}
                  onClick={() => setActiveTab("documentos")}
                >
                  <FileText className="w-4 h-4 mr-2" />
                  Documentos
                </Button>

                {!isFuncionario && (
                  <Button
                    variant={activeTab === "financeiro" ? "default" : "ghost"}
                    className={`w-full justify-start ${
                      activeTab === "financeiro"
                        ? "bg-cinema-yellow text-cinema-dark"
                        : "text-white hover:text-cinema-yellow"
                    }`}
                    onClick={() => setActiveTab("financeiro")}
                  >
                    <DollarSign className="w-4 h-4 mr-2" />
                    Financeiro
                  </Button>
                )}

                <Button
                  variant={activeTab === "importar" ? "default" : "ghost"}
                  className={`w-full justify-start ${
                    activeTab === "importar"
                      ? "bg-cinema-yellow text-cinema-dark"
                      : "text-white hover:text-cinema-yellow"
                  }`}
                  onClick={() => setActiveTab("importar")}
                >
                  <Upload className="w-4 h-4 mr-2" />
                  Importar Dados
                </Button>

                <Button
                  variant={activeTab === "ecommerce" ? "default" : "ghost"}
                  className={`w-full justify-start ${
                    activeTab === "ecommerce"
                      ? "bg-cinema-yellow text-cinema-dark"
                      : "text-white hover:text-cinema-yellow"
                  }`}
                  onClick={() => setActiveTab("ecommerce")}
                >
                  <Monitor className="w-4 h-4 mr-2" />
                  E-commerce
                </Button>

                <Button
                  variant={activeTab === "area-cliente" ? "default" : "ghost"}
                  className={`w-full justify-start ${
                    activeTab === "area-cliente"
                      ? "bg-cinema-yellow text-cinema-dark"
                      : "text-white hover:text-cinema-yellow"
                  }`}
                  onClick={() => setActiveTab("area-cliente")}
                >
                  <Users className="w-4 h-4 mr-2" />
                  Área do Cliente
                </Button>

                <Button
                  variant={activeTab === "multi-tenant" ? "default" : "ghost"}
                  className={`w-full justify-start ${
                    activeTab === "multi-tenant"
                      ? "bg-cinema-yellow text-cinema-dark"
                      : "text-white hover:text-cinema-yellow"
                  }`}
                  onClick={() => setActiveTab("multi-tenant")}
                >
                  <Palette className="w-4 h-4 mr-2" />
                  Multi-Locadoras
                </Button>

                <Button
                  variant={activeTab === "templates" ? "default" : "ghost"}
                  className={`w-full justify-start ${
                    activeTab === "templates"
                      ? "bg-cinema-yellow text-cinema-dark"
                      : "text-white hover:text-cinema-yellow"
                  }`}
                  onClick={() => setActiveTab("templates")}
                >
                  <Download className="w-4 h-4 mr-2" />
                  Templates
                </Button>

                <Button
                  variant={activeTab === "auto-ponto" ? "default" : "ghost"}
                  className={`w-full justify-start ${
                    activeTab === "auto-ponto"
                      ? "bg-cinema-yellow text-cinema-dark"
                      : "text-white hover:text-cinema-yellow"
                  }`}
                  onClick={() => setActiveTab("auto-ponto")}
                >
                  <Clock className="w-4 h-4 mr-2" />
                  Ponto Automático
                </Button>

                <Button
                  variant={activeTab === "funcionarios" ? "default" : "ghost"}
                  className={`w-full justify-start ${
                    activeTab === "funcionarios"
                      ? "bg-cinema-yellow text-cinema-dark"
                      : "text-white hover:text-cinema-yellow"
                  }`}
                  onClick={() => setActiveTab("funcionarios")}
                >
                  <Users className="w-4 h-4 mr-2" />
                  Funcionários
                </Button>

                <Button
                  variant={activeTab === "configuracoes" ? "default" : "ghost"}
                  className={`w-full justify-start ${
                    activeTab === "configuracoes"
                      ? "bg-cinema-yellow text-cinema-dark"
                      : "text-white hover:text-cinema-yellow"
                  }`}
                  onClick={() => setActiveTab("configuracoes")}
                >
                  <Settings className="w-4 h-4 mr-2" />
                  Configurações
                </Button>
              </nav>
            </div>
          </div>

          {/* Main Content */}
          <div className="flex-1 p-8">
            {/* Dashboard Tab */}
            {activeTab === "dashboard" && (
              <div className="space-y-8">
                <div className="flex justify-between items-center">
                  <h2 className="text-3xl font-bold text-white" data-edit-id="dashboard.title">Dashboard</h2>
                  <div className="flex items-center space-x-2">
                    <Button
                      variant="outline"
                      className="text-cinema-yellow border-cinema-yellow"
                      onClick={() => setActiveTab("importar")}
                    >
                      <Upload className="w-4 h-4 mr-2" />
                      Importar Dados
                    </Button>
                    <Button
                      variant="outline"
                      className="text-cinema-yellow border-cinema-yellow"
                    >
                      <Calendar className="w-4 h-4 mr-2" />
                      Hoje
                    </Button>
                  </div>
                </div>

                {/* Metrics Cards */}
                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                  <Card className="bg-cinema-gray border-cinema-gray-light">
                    <CardContent className="p-6">
                      <div className="flex items-center justify-between">
                        <div>
                          <p className="text-gray-400 text-sm" data-edit-id="dashboard.equipment-label">
                            Equipamentos Disponíveis
                          </p>
                          <p className="text-3xl font-bold text-white">
                            {dashboardMetrics.equipmentAvailable}
                          </p>
                        </div>
                        <div className="p-3 bg-cinema-yellow/20 rounded-lg">
                          <Package className="w-6 h-6 text-cinema-yellow" />
                        </div>
                      </div>
                    </CardContent>
                  </Card>

                  <Card className="bg-cinema-gray border-cinema-gray-light">
                    <CardContent className="p-6">
                      <div className="flex items-center justify-between">
                        <div>
                          <p className="text-gray-400 text-sm" data-edit-id="dashboard.orders-label">
                            Pedidos Ativos
                          </p>
                          <p className="text-3xl font-bold text-white">
                            {dashboardMetrics.activeOrders}
                          </p>
                        </div>
                        <div className="p-3 bg-green-400/20 rounded-lg">
                          <TrendingUp className="w-6 h-6 text-green-400" />
                        </div>
                      </div>
                    </CardContent>
                  </Card>

                  <Card className="bg-cinema-gray border-cinema-gray-light" data-edit-id="dashboard.revenue-card">
                    <CardContent className="p-6">
                      <div className="flex items-center justify-between">
                        <div>
                          <p className="text-gray-400 text-sm" data-edit-id="dashboard.revenue-label">
                            Faturamento do Mês
                          </p>
                          <p className="text-3xl font-bold text-white">
                            R${" "}
                            {dashboardMetrics.monthlyRevenue.toLocaleString()}
                          </p>
                        </div>
                        <div className="p-3 bg-green-400/20 rounded-lg">
                          <DollarSign className="w-6 h-6 text-green-400" />
                        </div>
                      </div>
                    </CardContent>
                  </Card>

                  <Card className="bg-cinema-gray border-cinema-gray-light" data-edit-id="dashboard.alerts-card">
                    <CardContent className="p-6">
                      <div className="flex items-center justify-between">
                        <div>
                          <p className="text-gray-400 text-sm" data-edit-id="dashboard.alerts-label">
                            Alertas de Manutenção
                          </p>
                          <p className="text-3xl font-bold text-white">
                            {dashboardMetrics.maintenanceAlerts}
                          </p>
                        </div>
                        <div className="p-3 bg-red-400/20 rounded-lg">
                          <AlertTriangle className="w-6 h-6 text-red-400" />
                        </div>
                      </div>
                    </CardContent>
                  </Card>
                </div>

                {/* Charts and Recent Activity */}
                <div className="grid grid-cols-1 lg:grid-cols-2 gap-8">
                  {/* Recent Orders */}
                  <Card className="bg-cinema-gray border-cinema-gray-light" data-edit-id="dashboard.recent-orders-card">
                    <CardHeader>
                      <CardTitle className="text-white" data-edit-id="dashboard.recent-orders-title">
                        Pedidos Recentes
                      </CardTitle>
                    </CardHeader>
                    <CardContent className="space-y-4">
                      {recentOrders.map((order) => (
                        <div
                          key={order.id}
                          className="flex justify-between items-center p-3 bg-cinema-dark-lighter rounded-lg"
                        >
                          <div>
                            <p className="text-white font-medium">{order.id}</p>
                            <p className="text-gray-400 text-sm">
                              {order.client}
                            </p>
                            <p className="text-gray-400 text-xs">
                              {order.items.join(", ")}
                            </p>
                          </div>
                          <div className="text-right">
                            <div
                              className={`flex items-center ${getStatusColor(order.status)}`}
                            >
                              {getStatusIcon(order.status)}
                              <span className="ml-1 text-sm capitalize">
                                {order.status === "em locação" ? (
                                  <p>em locações</p>
                                ) : (
                                  order.status
                                )}
                              </span>
                            </div>
                            <p className="text-cinema-yellow text-sm">
                              R$ {order.total.toFixed(2)}
                            </p>
                          </div>
                        </div>
                      ))}
                    </CardContent>
                  </Card>

                  {/* Maintenance Alerts */}
                  <Card className="bg-cinema-gray border-cinema-gray-light" data-edit-id="dashboard.maintenance-card">
                    <CardHeader>
                      <CardTitle className="text-white" data-edit-id="dashboard.maintenance-title">
                        Alertas de Manutenção
                      </CardTitle>
                    </CardHeader>
                    <CardContent className="space-y-4">
                      {maintenanceAlerts.map((alert, index) => (
                        <div
                          key={index}
                          className="p-3 bg-cinema-dark-lighter rounded-lg border-l-4 border-l-red-400"
                        >
                          <div className="flex justify-between items-start">
                            <div>
                              <p className="text-white font-medium">
                                {alert.equipment}
                              </p>
                              <p className="text-gray-400 text-sm">
                                {alert.issue}
                              </p>
                            </div>
                            <span
                              className={`text-xs px-2 py-1 rounded ${getPriorityColor(alert.priority)}`}
                            >
                              {alert.priority}
                            </span>
                          </div>
                        </div>
                      ))}
                    </CardContent>
                  </Card>
                </div>

                {/* Dashboard Charts */}
                <DashboardCharts />
              </div>
            )}

            {/* Pedidos Tab */}
            {activeTab === "pedidos" && (
              <div className="space-y-6">
                <div className="flex justify-between items-center">
                  <h2 className="text-3xl font-bold text-white">
                    Gestão de Pedidos
                  </h2>
                  <Button
                    className="bg-cinema-yellow text-cinema-dark hover:bg-cinema-yellow-dark"
                    onClick={() => {
                      setNewOrderForm((prev) => ({
                        ...prev,
                        orderNumber: nextOrderNumber,
                      }));
                      setClientSearchTerm("");
                      setShowNewOrderModal(true);
                    }}
                  >
                    <Plus className="w-4 h-4 mr-2" />
                    Novo Pedido
                  </Button>
                </div>

                {/* Filters */}
                <div className="flex flex-wrap gap-4">
                  <div className="relative">
                    <Search className="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4" />
                    <Input
                      placeholder="Buscar pedidos..."
                      value={searchTerm}
                      onChange={(e) => setSearchTerm(e.target.value)}
                      className="pl-10 bg-cinema-gray border-cinema-gray-light text-white"
                    />
                  </div>

                  <select
                    value={filterStatus}
                    onChange={(e) => setFilterStatus(e.target.value)}
                    className="bg-cinema-gray border border-cinema-gray-light text-white rounded-md px-3 py-2"
                  >
                    <option value="todos">Todos os Status</option>
                    <option value="ativo">Ativo</option>
                    <option value="em locação">Em Locação</option>
                    <option value="concluído">Concluído</option>
                    <option value="atrasado">Atrasado</option>
                  </select>
                </div>

                {/* Orders List */}
                <Card className="bg-cinema-gray border-cinema-gray-light">
                  <CardContent className="p-0">
                    <div className="overflow-x-auto">
                      <table className="w-full">
                        <thead className="border-b border-cinema-gray-light">
                          <tr>
                            <th className="px-6 py-4 text-left text-cinema-yellow font-medium">
                              ID
                            </th>
                            <th className="px-6 py-4 text-left text-cinema-yellow font-medium">
                              Cliente
                            </th>
                            <th className="px-6 py-4 text-left text-cinema-yellow font-medium">
                              Equipamentos
                            </th>
                            <th className="px-6 py-4 text-left text-cinema-yellow font-medium">
                              Valor
                            </th>
                            <th className="px-6 py-4 text-left text-cinema-yellow font-medium">
                              Status
                            </th>
                            <th className="px-6 py-4 text-left text-cinema-yellow font-medium">
                              A��ões
                            </th>
                          </tr>
                        </thead>
                        <tbody>
                          {recentOrders.map((order) => (
                            <tr
                              key={order.id}
                              className="border-b border-cinema-gray-light hover:bg-cinema-dark-lighter"
                            >
                              <td className="px-6 py-4 text-white font-medium">
                                {order.id}
                              </td>
                              <td className="px-6 py-4 text-white">
                                {order.client}
                              </td>
                              <td className="px-6 py-4 text-gray-400 text-sm">
                                {order.items.join(", ")}
                              </td>
                              <td className="px-6 py-4 text-cinema-yellow">
                                R$ {order.total.toFixed(2)}
                              </td>
                              <td className="px-6 py-4">
                                <div
                                  className={`flex items-center ${getStatusColor(order.status)}`}
                                >
                                  {getStatusIcon(order.status)}
                                  <span className="ml-1 text-sm capitalize">
                                    {order.status}
                                  </span>
                                </div>
                              </td>
                              <td className="px-6 py-4">
                                <div className="flex space-x-2">
                                  <Button
                                    size="sm"
                                    variant="outline"
                                    className="text-cinema-yellow border-cinema-yellow"
                                    onClick={(e) => {
                                      e.preventDefault();
                                      e.stopPropagation();
                                      viewOrder(order);
                                    }}
                                  >
                                    <Eye className="w-4 h-4" />
                                  </Button>
                                  <Button
                                    size="sm"
                                    variant="outline"
                                    className="text-cinema-yellow border-cinema-yellow"
                                  >
                                    <Download className="w-4 h-4" />
                                  </Button>
                                </div>
                              </td>
                            </tr>
                          ))}
                        </tbody>
                      </table>
                    </div>
                  </CardContent>
                </Card>

                {/* Enhanced Order Modal - Professional Style */}
                {showNewOrderModal && (
                  <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50">
                    <div className="bg-cinema-gray border border-cinema-gray-light rounded-lg w-full max-w-6xl mx-4 max-h-[95vh] overflow-hidden">
                      {/* Modal Header */}
                      <div className="flex justify-between items-center p-6 border-b border-cinema-gray-light">
                        <div>
                          <h3 className="text-xl font-bold text-white">
                            Ficha de Locação
                          </h3>
                          <p className="text-gray-400 text-sm">
                            Novo pedido - Sistema de locação profissional
                          </p>
                        </div>
                        <Button
                          variant="ghost"
                          size="sm"
                          onClick={() => {
                            setShowNewOrderModal(false);
                            setClientSearchTerm("");
                            setShowClientSuggestions(false);
                          }}
                          className="text-gray-400 hover:text-white"
                        >
                          <X className="w-4 h-4" />
                        </Button>
                      </div>

                      <div className="flex h-[calc(95vh-120px)]">
                        {/* Left Panel */}
                        <div className="w-1/3 p-6 border-r border-cinema-gray-light overflow-y-auto">
                          <form
                            onSubmit={handleNewOrderSubmit}
                            className="space-y-4"
                          >
                            {/* Basic Information */}
                            <div className="space-y-4">
                              <h4 className="text-cinema-yellow font-semibold text-sm">
                                INFORMAÇÕES BÁSICAS
                              </h4>

                              <div className="grid grid-cols-2 gap-3">
                                <div>
                                  <Label className="text-white text-xs">
                                    Número
                                  </Label>
                                  <Input
                                    value={newOrderForm.orderNumber}
                                    onChange={(e) =>
                                      handleFormChange(
                                        "orderNumber",
                                        e.target.value,
                                      )
                                    }
                                    className="bg-cinema-dark-lighter border-cinema-gray-light text-white text-sm"
                                  />
                                </div>
                                <div>
                                  <Label className="text-white text-xs">
                                    Orçamento
                                  </Label>
                                  <Input
                                    value={newOrderForm.quoteNumber}
                                    onChange={(e) =>
                                      handleFormChange(
                                        "quoteNumber",
                                        e.target.value,
                                      )
                                    }
                                    className="bg-cinema-dark-lighter border-cinema-gray-light text-white text-sm"
                                    placeholder="Número do orçamento"
                                  />
                                </div>
                              </div>

                              <div className="grid grid-cols-2 gap-3">
                                <div>
                                  <Label className="text-white text-xs">
                                    Status
                                  </Label>
                                  <select
                                    value={newOrderForm.status}
                                    onChange={(e) =>
                                      handleFormChange("status", e.target.value)
                                    }
                                    className="w-full bg-cinema-dark-lighter border border-cinema-gray-light text-white rounded-md px-3 py-2 text-sm"
                                  >
                                    <option value="Orcamento">Orçamento</option>
                                    <option value="Aprovado">Aprovado</option>
                                    <option value="Em Producao">
                                      Em Produção
                                    </option>
                                    <option value="Em Locacao">
                                      Em Locação
                                    </option>
                                    <option value="Entregue">Entregue</option>
                                    <option value="Devolvido">Devolvido</option>
                                    <option value="Cancelado">Cancelado</option>
                                  </select>
                                </div>
                                <div>
                                  <Label className="text-white text-xs">
                                    Prioridade
                                  </Label>
                                  <select
                                    value={newOrderForm.priority}
                                    onChange={(e) =>
                                      handleFormChange(
                                        "priority",
                                        e.target.value,
                                      )
                                    }
                                    className="w-full bg-cinema-dark-lighter border border-cinema-gray-light text-white rounded-md px-3 py-2 text-sm"
                                  >
                                    <option value="Baixa">Baixa</option>
                                    <option value="Normal">Normal</option>
                                    <option value="Alta">Alta</option>
                                    <option value="Urgente">Urgente</option>
                                  </select>
                                </div>
                              </div>

                              <div className="grid grid-cols-2 gap-3">
                                <div>
                                  <Label className="text-white text-xs">
                                    Data Emissão
                                  </Label>
                                  <Input
                                    type="date"
                                    value={newOrderForm.issueDate}
                                    onChange={(e) =>
                                      handleFormChange(
                                        "issueDate",
                                        e.target.value,
                                      )
                                    }
                                    className="bg-cinema-dark-lighter border-cinema-gray-light text-white text-sm"
                                    style={{ colorScheme: "dark" }}
                                  />
                                </div>
                                <div>
                                  <Label className="text-white text-xs">
                                    Hora Emissão
                                  </Label>
                                  <Input
                                    type="time"
                                    value={newOrderForm.issueTime}
                                    onChange={(e) =>
                                      handleFormChange(
                                        "issueTime",
                                        e.target.value,
                                      )
                                    }
                                    className="bg-cinema-dark-lighter border-cinema-gray-light text-white text-sm"
                                    style={{ colorScheme: "dark" }}
                                  />
                                </div>
                              </div>

                              <div>
                                <Label className="text-white text-xs">
                                  Vendedor/Representante
                                </Label>
                                <Input
                                  value={newOrderForm.salesperson}
                                  onChange={(e) =>
                                    handleFormChange(
                                      "salesperson",
                                      e.target.value,
                                    )
                                  }
                                  className="bg-cinema-dark-lighter border-cinema-gray-light text-white text-sm"
                                  placeholder="Nome do vendedor"
                                />
                              </div>

                              <div>
                                <Label className="text-white text-xs">
                                  Origem
                                </Label>
                                <select
                                  value={newOrderForm.origin}
                                  onChange={(e) =>
                                    handleFormChange("origin", e.target.value)
                                  }
                                  className="w-full bg-cinema-dark-lighter border border-cinema-gray-light text-white rounded-md px-3 py-2 text-sm"
                                >
                                  <option value="Balcao">Balcão</option>
                                  <option value="Telefone">Telefone</option>
                                  <option value="Email">E-mail</option>
                                  <option value="Site">Site</option>
                                  <option value="Whatsapp">WhatsApp</option>
                                  <option value="Representante">
                                    Representante
                                  </option>
                                </select>
                              </div>
                            </div>

                            {/* Client Information */}
                            <div className="space-y-4">
                              <h4 className="text-cinema-yellow font-semibold text-sm">
                                CLIENTE
                              </h4>

                              <div className="relative">
                                <Label className="text-white text-xs">
                                  Nome do Cliente
                                </Label>
                                <Input
                                  value={clientSearchTerm}
                                  onChange={(e) =>
                                    handleClientSearch(e.target.value)
                                  }
                                  onFocus={() =>
                                    setShowClientSuggestions(
                                      clientSearchTerm.length > 0,
                                    )
                                  }
                                  className="bg-cinema-dark-lighter border-cinema-gray-light text-white text-sm"
                                  placeholder="Digite o nome do cliente..."
                                  required
                                />
                                {showClientSuggestions &&
                                  filteredClients.length > 0 && (
                                    <div className="absolute top-full mt-1 w-full bg-cinema-dark-lighter border border-cinema-gray-light rounded-lg shadow-lg z-50 max-h-48 overflow-y-auto">
                                      {filteredClients.map((client, index) => (
                                        <button
                                          key={index}
                                          type="button"
                                          onClick={() => selectClient(client)}
                                          className="w-full text-left px-3 py-2 hover:bg-cinema-yellow hover:text-cinema-dark transition-colors text-white text-sm border-b border-cinema-gray-light last:border-b-0"
                                        >
                                          <div>
                                            <p className="font-medium">
                                              {client.name}
                                            </p>
                                            <p className="text-xs opacity-75">
                                              {client.email} • {client.phone}
                                            </p>
                                          </div>
                                        </button>
                                      ))}
                                    </div>
                                  )}
                              </div>

                              <div className="grid grid-cols-2 gap-3">
                                <div>
                                  <Label className="text-white text-xs">
                                    CNPJ/CPF
                                  </Label>
                                  <Input
                                    value={newOrderForm.clientCNPJ}
                                    onChange={(e) =>
                                      handleFormChange(
                                        "clientCNPJ",
                                        e.target.value,
                                      )
                                    }
                                    className="bg-cinema-dark-lighter border-cinema-gray-light text-white text-sm"
                                    placeholder="00.000.000/0000-00"
                                  />
                                </div>
                                <div>
                                  <Label className="text-white text-xs">
                                    Telefone
                                  </Label>
                                  <Input
                                    value={newOrderForm.clientPhone}
                                    onChange={(e) =>
                                      handleFormChange(
                                        "clientPhone",
                                        e.target.value,
                                      )
                                    }
                                    className="bg-cinema-dark-lighter border-cinema-gray-light text-white text-sm"
                                    required
                                  />
                                </div>
                              </div>

                              <div>
                                <Label className="text-white text-xs">
                                  E-mail
                                </Label>
                                <Input
                                  type="email"
                                  value={newOrderForm.clientEmail}
                                  onChange={(e) =>
                                    handleFormChange(
                                      "clientEmail",
                                      e.target.value,
                                    )
                                  }
                                  className="bg-cinema-dark-lighter border-cinema-gray-light text-white text-sm"
                                  required
                                />
                              </div>

                              <div>
                                <Label className="text-white text-xs">
                                  Endereço
                                </Label>
                                <Input
                                  value={newOrderForm.clientAddress}
                                  onChange={(e) =>
                                    handleFormChange(
                                      "clientAddress",
                                      e.target.value,
                                    )
                                  }
                                  className="bg-cinema-dark-lighter border-cinema-gray-light text-white text-sm"
                                  placeholder="Endereço completo"
                                />
                              </div>

                              <div>
                                <Label className="text-white text-xs">
                                  Cidade
                                </Label>
                                <Input
                                  value={newOrderForm.clientCity}
                                  onChange={(e) =>
                                    handleFormChange(
                                      "clientCity",
                                      e.target.value,
                                    )
                                  }
                                  className="bg-cinema-dark-lighter border-cinema-gray-light text-white text-sm"
                                />
                              </div>
                            </div>

                            {/* Delivery Information */}
                            <div className="space-y-4">
                              <h4 className="text-cinema-yellow font-semibold text-sm">
                                ENTREGA/RETIRADA
                              </h4>

                              <div>
                                <Label className="text-white text-xs">
                                  Tipo de Entrega
                                </Label>
                                <select
                                  value={newOrderForm.deliveryType}
                                  onChange={(e) =>
                                    handleFormChange(
                                      "deliveryType",
                                      e.target.value,
                                    )
                                  }
                                  className="w-full bg-cinema-dark-lighter border border-cinema-gray-light text-white rounded-md px-3 py-2 text-sm"
                                >
                                  <option value="Retirada">
                                    Retirada na Loja
                                  </option>
                                  <option value="Entrega">
                                    Entrega no Local
                                  </option>
                                  <option value="Correios">Correios</option>
                                  <option value="Transportadora">
                                    Transportadora
                                  </option>
                                </select>
                              </div>

                              {newOrderForm.deliveryType !== "Retirada" && (
                                <div>
                                  <Label className="text-white text-xs">
                                    Endereço de Entrega
                                  </Label>
                                  <textarea
                                    value={newOrderForm.deliveryAddress}
                                    onChange={(e) =>
                                      handleFormChange(
                                        "deliveryAddress",
                                        e.target.value,
                                      )
                                    }
                                    className="w-full bg-cinema-dark-lighter border border-cinema-gray-light text-white rounded-md px-3 py-2 text-sm resize-none"
                                    rows={2}
                                    placeholder="Endereço completo para entrega"
                                  />
                                </div>
                              )}

                              <div className="grid grid-cols-2 gap-3">
                                <div>
                                  <Label className="text-white text-xs">
                                    Data Retirada/Entrega
                                  </Label>
                                  <Input
                                    type="date"
                                    value={newOrderForm.pickupDate}
                                    onChange={(e) =>
                                      handleFormChange(
                                        "pickupDate",
                                        e.target.value,
                                      )
                                    }
                                    className="bg-cinema-dark-lighter border-cinema-gray-light text-white text-sm"
                                    style={{ colorScheme: "dark" }}
                                    required
                                  />
                                </div>
                                <div>
                                  <Label className="text-white text-xs">
                                    Horário
                                  </Label>
                                  <Input
                                    type="time"
                                    value={newOrderForm.pickupTime}
                                    onChange={(e) =>
                                      handleFormChange(
                                        "pickupTime",
                                        e.target.value,
                                      )
                                    }
                                    className="bg-cinema-dark-lighter border-cinema-gray-light text-white text-sm"
                                    style={{ colorScheme: "dark" }}
                                    required
                                  />
                                </div>
                              </div>

                              <div className="grid grid-cols-2 gap-3">
                                <div>
                                  <Label className="text-white text-xs">
                                    Data Devolução
                                  </Label>
                                  <Input
                                    type="date"
                                    value={newOrderForm.returnDate}
                                    onChange={(e) =>
                                      handleFormChange(
                                        "returnDate",
                                        e.target.value,
                                      )
                                    }
                                    className="bg-cinema-dark-lighter border-cinema-gray-light text-white text-sm"
                                    style={{ colorScheme: "dark" }}
                                    required
                                  />
                                </div>
                                <div>
                                  <Label className="text-white text-xs">
                                    Horário
                                  </Label>
                                  <Input
                                    type="time"
                                    value={newOrderForm.returnTime}
                                    onChange={(e) =>
                                      handleFormChange(
                                        "returnTime",
                                        e.target.value,
                                      )
                                    }
                                    className="bg-cinema-dark-lighter border-cinema-gray-light text-white text-sm"
                                    style={{ colorScheme: "dark" }}
                                    required
                                  />
                                </div>
                              </div>
                            </div>

                            {/* Form Actions */}
                            <div className="flex space-x-3 pt-6">
                              <Button
                                type="submit"
                                className="flex-1 bg-cinema-yellow text-cinema-dark hover:bg-cinema-yellow-dark text-sm"
                              >
                                Salvar Pedido
                              </Button>
                              <Button
                                type="button"
                                variant="outline"
                                onClick={() => {
                                  setShowNewOrderModal(false);
                                  setClientSearchTerm("");
                                  setShowClientSuggestions(false);
                                }}
                                className="flex-1 text-gray-400 border-gray-400 hover:text-white hover:border-white text-sm"
                              >
                                Cancelar
                              </Button>
                            </div>
                          </form>
                        </div>

                        {/* Right Panel - Equipment Grid */}
                        <div className="flex-1 p-6 overflow-y-auto">
                          <div className="space-y-4">
                            <div className="flex justify-between items-center">
                              <h4 className="text-cinema-yellow font-semibold">
                                EQUIPAMENTOS E PRODUTOS
                              </h4>
                              <Button
                                size="sm"
                                className="bg-cinema-yellow text-cinema-dark hover:bg-cinema-yellow-dark"
                                onClick={() =>
                                  setShowProductSelectionModal(true)
                                }
                              >
                                <Plus className="w-4 h-4 mr-1" />
                                Adicionar Produtos
                              </Button>
                            </div>

                            {/* Equipment Table */}
                            <div className="bg-cinema-dark-lighter rounded-lg border border-cinema-gray-light">
                              <div className="p-4">
                                <table className="w-full text-sm">
                                  <thead>
                                    <tr className="border-b border-cinema-gray-light">
                                      <th className="text-left text-cinema-yellow p-2">
                                        Código
                                      </th>
                                      <th className="text-left text-cinema-yellow p-2">
                                        Descrição
                                      </th>
                                      <th className="text-left text-cinema-yellow p-2">
                                        Qtd
                                      </th>
                                      <th className="text-left text-cinema-yellow p-2">
                                        Valor Unit.
                                      </th>
                                      <th className="text-left text-cinema-yellow p-2">
                                        Dias
                                      </th>
                                      <th className="text-left text-cinema-yellow p-2">
                                        Desc %
                                      </th>
                                      <th className="text-left text-cinema-yellow p-2">
                                        Total
                                      </th>
                                      <th className="text-left text-cinema-yellow p-2">
                                        Ações
                                      </th>
                                    </tr>
                                  </thead>
                                  <tbody>
                                    {!newOrderForm.equipment ||
                                    newOrderForm.equipment.length === 0 ? (
                                      <tr>
                                        <td
                                          colSpan={8}
                                          className="text-center text-gray-400 p-8"
                                        >
                                          Nenhum equipamento adicionado
                                          <br />
                                          <span className="text-xs">
                                            Clique em "Adicionar Produtos" para
                                            começar
                                          </span>
                                        </td>
                                      </tr>
                                    ) : (
                                      newOrderForm.equipment.map(
                                        (item: any, index: number) => (
                                          <tr
                                            key={item.id}
                                            className="border-b border-cinema-gray-light"
                                          >
                                            <td className="p-2">
                                              <Input
                                                value={item.code || ""}
                                                onChange={(e) => {
                                                  const updatedEquipment = [
                                                    ...newOrderForm.equipment,
                                                  ];
                                                  updatedEquipment[index] = {
                                                    ...item,
                                                    code: e.target.value,
                                                  };
                                                  handleFormChange(
                                                    "equipment",
                                                    updatedEquipment.join(", "),
                                                  );
                                                }}
                                                placeholder="Código"
                                                className="bg-cinema-gray border-cinema-gray-light text-white text-xs h-8"
                                              />
                                            </td>
                                            <td className="p-2">
                                              <Input
                                                value={item.name}
                                                onChange={(e) => {
                                                  const updatedEquipment = [
                                                    ...newOrderForm.equipment,
                                                  ];
                                                  updatedEquipment[index] = {
                                                    ...item,
                                                    name: e.target.value,
                                                  };
                                                  handleFormChange(
                                                    "equipment",
                                                    updatedEquipment.join(", "),
                                                  );
                                                }}
                                                placeholder="Descriç��o do equipamento"
                                                className="bg-cinema-gray border-cinema-gray-light text-white text-xs h-8"
                                              />
                                            </td>
                                            <td className="p-2">
                                              <Input
                                                type="number"
                                                value={item.quantity}
                                                onChange={(e) => {
                                                  const updatedEquipment = [
                                                    ...newOrderForm.equipment,
                                                  ];
                                                  updatedEquipment[index] = {
                                                    ...item,
                                                    quantity:
                                                      parseInt(
                                                        e.target.value,
                                                      ) || 1,
                                                  };
                                                  handleFormChange(
                                                    "equipment",
                                                    updatedEquipment.join(", "),
                                                  );
                                                  updateOrderTotals(
                                                    updatedEquipment,
                                                  );
                                                }}
                                                min="1"
                                                className="bg-cinema-gray border-cinema-gray-light text-white text-xs h-8 w-16"
                                              />
                                            </td>
                                            <td className="p-2">
                                              <Input
                                                type="number"
                                                value={item.unitPrice}
                                                onChange={(e) => {
                                                  const updatedEquipment = [
                                                    ...newOrderForm.equipment,
                                                  ];
                                                  updatedEquipment[index] = {
                                                    ...item,
                                                    unitPrice:
                                                      parseFloat(
                                                        e.target.value,
                                                      ) || 0,
                                                  };
                                                  handleFormChange(
                                                    "equipment",
                                                    updatedEquipment.join(", "),
                                                  );
                                                  updateOrderTotals(
                                                    updatedEquipment,
                                                  );
                                                }}
                                                step="0.01"
                                                placeholder="0.00"
                                                className="bg-cinema-gray border-cinema-gray-light text-white text-xs h-8 w-20"
                                              />
                                            </td>
                                            <td className="p-2">
                                              <Input
                                                type="number"
                                                value={item.days}
                                                onChange={(e) => {
                                                  const updatedEquipment = [
                                                    ...newOrderForm.equipment,
                                                  ];
                                                  updatedEquipment[index] = {
                                                    ...item,
                                                    days:
                                                      parseInt(
                                                        e.target.value,
                                                      ) || 1,
                                                  };
                                                  handleFormChange(
                                                    "equipment",
                                                    updatedEquipment.join(", "),
                                                  );
                                                  updateOrderTotals(
                                                    updatedEquipment,
                                                  );
                                                }}
                                                min="1"
                                                className="bg-cinema-gray border-cinema-gray-light text-white text-xs h-8 w-16"
                                              />
                                            </td>
                                            <td className="p-2">
                                              <Input
                                                type="number"
                                                value={item.discount}
                                                onChange={(e) => {
                                                  const updatedEquipment = [
                                                    ...newOrderForm.equipment,
                                                  ];
                                                  updatedEquipment[index] = {
                                                    ...item,
                                                    discount:
                                                      parseFloat(
                                                        e.target.value,
                                                      ) || 0,
                                                  };
                                                  handleFormChange(
                                                    "equipment",
                                                    updatedEquipment.join(", "),
                                                  );
                                                  updateOrderTotals(
                                                    updatedEquipment,
                                                  );
                                                }}
                                                min="0"
                                                max="100"
                                                className="bg-cinema-gray border-cinema-gray-light text-white text-xs h-8 w-16"
                                              />
                                            </td>
                                            <td className="p-2 text-cinema-yellow font-medium">
                                              R${" "}
                                              {(
                                                item.unitPrice *
                                                item.quantity *
                                                item.days *
                                                (1 - item.discount / 100)
                                              ).toFixed(2)}
                                            </td>
                                            <td className="p-2">
                                              <Button
                                                size="sm"
                                                variant="outline"
                                                className="text-red-400 border-red-400 h-8 w-8 p-0"
                                                onClick={() => {
                                                  const updatedEquipment =
                                                    newOrderForm.equipment.filter(
                                                      (_: any, i: number) =>
                                                        i !== index,
                                                    );
                                                  handleFormChange(
                                                    "equipment",
                                                    updatedEquipment.join(", "),
                                                  );
                                                  updateOrderTotals(
                                                    updatedEquipment,
                                                  );
                                                }}
                                              >
                                                <Trash2 className="w-3 h-3" />
                                              </Button>
                                            </td>
                                          </tr>
                                        ),
                                      )
                                    )}
                                  </tbody>
                                </table>
                              </div>
                            </div>

                            {/* Project Information */}
                            <div className="grid grid-cols-2 gap-4 mt-6">
                              <Card className="bg-cinema-dark border-cinema-gray-light">
                                <CardContent className="p-4">
                                  <h5 className="text-cinema-yellow font-semibold text-sm mb-3">
                                    PROJETO
                                  </h5>
                                  <div className="space-y-3">
                                    <div>
                                      <Label className="text-white text-xs">
                                        Nome do Projeto
                                      </Label>
                                      <Input
                                        value={newOrderForm.projectName}
                                        onChange={(e) =>
                                          handleFormChange(
                                            "projectName",
                                            e.target.value,
                                          )
                                        }
                                        className="bg-cinema-gray border-cinema-gray-light text-white text-sm"
                                        placeholder="Nome do filme/projeto"
                                      />
                                    </div>
                                    <div>
                                      <Label className="text-white text-xs">
                                        Direção
                                      </Label>
                                      <Input
                                        value={newOrderForm.director}
                                        onChange={(e) =>
                                          handleFormChange(
                                            "director",
                                            e.target.value,
                                          )
                                        }
                                        className="bg-cinema-gray border-cinema-gray-light text-white text-sm"
                                        placeholder="Nome do diretor"
                                      />
                                    </div>
                                    <div>
                                      <Label className="text-white text-xs">
                                        Produção
                                      </Label>
                                      <Input
                                        value={newOrderForm.producer}
                                        onChange={(e) =>
                                          handleFormChange(
                                            "producer",
                                            e.target.value,
                                          )
                                        }
                                        className="bg-cinema-gray border-cinema-gray-light text-white text-sm"
                                        placeholder="Nome do produtor"
                                      />
                                    </div>
                                  </div>
                                </CardContent>
                              </Card>

                              <Card className="bg-cinema-dark border-cinema-gray-light">
                                <CardContent className="p-4">
                                  <h5 className="text-cinema-yellow font-semibold text-sm mb-3">
                                    VALORES
                                  </h5>
                                  <div className="space-y-3">
                                    <div className="flex justify-between">
                                      <span className="text-gray-400 text-sm">
                                        Subtotal:
                                      </span>
                                      <span className="text-white">
                                        R$ {newOrderForm.subtotal.toFixed(2)}
                                      </span>
                                    </div>

                                    {/* General Discount Section */}
                                    <div className="space-y-2">
                                      <Label className="text-white text-xs">
                                        Desconto Geral
                                      </Label>
                                      <div className="flex space-x-2">
                                        <select
                                          value={
                                            newOrderForm.discountGeneralType
                                          }
                                          onChange={(e) => {
                                            handleFormChange(
                                              "discountGeneralType",
                                              e.target.value,
                                            );
                                            setTimeout(
                                              () => updateOrderTotals(),
                                              100,
                                            );
                                          }}
                                          className="bg-cinema-gray border border-cinema-gray-light text-white rounded-md px-2 py-1 text-xs w-20"
                                        >
                                          <option value="percentage">%</option>
                                          <option value="fixed">R$</option>
                                        </select>
                                        <Input
                                          type="number"
                                          value={newOrderForm.discountValue}
                                          onChange={(e) => {
                                            handleFormChange(
                                              "discountValue",
                                              (parseFloat(e.target.value) || 0).toString(),
                                            );
                                            setTimeout(
                                              () => updateOrderTotals(),
                                              100,
                                            );
                                          }}
                                          min="0"
                                          step="0.01"
                                          placeholder="0.00"
                                          className="bg-cinema-gray border-cinema-gray-light text-white text-xs h-8"
                                        />
                                      </div>
                                      <div className="text-xs text-gray-400">
                                        {newOrderForm.discountGeneralType ===
                                        "percentage"
                                          ? `${newOrderForm.discountValue}% = R$ ${((newOrderForm.subtotal * newOrderForm.discountValue) / 100).toFixed(2)}`
                                          : `R$ ${newOrderForm.discountValue.toFixed(2)}`}
                                      </div>
                                    </div>

                                    <div className="flex justify-between">
                                      <span className="text-gray-400 text-sm">
                                        Desconto Total:
                                      </span>
                                      <span className="text-red-400">
                                        - R$ {newOrderForm.discount.toFixed(2)}
                                      </span>
                                    </div>

                                    <Separator className="bg-cinema-gray-light" />

                                    <div className="flex justify-between">
                                      <span className="text-cinema-yellow font-semibold">
                                        Total:
                                      </span>
                                      <span className="text-cinema-yellow font-bold text-lg">
                                        R$ {newOrderForm.total.toFixed(2)}
                                      </span>
                                    </div>

                                    <div className="mt-4">
                                      <Label className="text-white text-xs">
                                        Condição Pagamento
                                      </Label>
                                      <select
                                        value={newOrderForm.paymentCondition}
                                        onChange={(e) =>
                                          handleFormChange(
                                            "paymentCondition",
                                            e.target.value,
                                          )
                                        }
                                        className="w-full bg-cinema-gray border border-cinema-gray-light text-white rounded-md px-3 py-2 text-sm"
                                      >
                                        <option value="A vista">À vista</option>
                                        <option value="30 dias">30 dias</option>
                                        <option value="Parcelado">
                                          Parcelado
                                        </option>
                                        <option value="Deposito">
                                          Depósito
                                        </option>
                                      </select>
                                    </div>
                                  </div>
                                </CardContent>
                              </Card>
                            </div>

                            {/* Notes */}
                            <Card className="bg-cinema-dark border-cinema-gray-light">
                              <CardContent className="p-4">
                                <h5 className="text-cinema-yellow font-semibold text-sm mb-3">
                                  OBSERVAÇÕES
                                </h5>
                                <div className="grid grid-cols-2 gap-4">
                                  <div>
                                    <Label className="text-white text-xs">
                                      Observações do Cliente
                                    </Label>
                                    <textarea
                                      value={newOrderForm.notes}
                                      onChange={(e) =>
                                        handleFormChange(
                                          "notes",
                                          e.target.value,
                                        )
                                      }
                                      className="w-full bg-cinema-gray border border-cinema-gray-light text-white rounded-md px-3 py-2 text-sm resize-none"
                                      rows={3}
                                      placeholder="Observações visíveis ao cliente..."
                                    />
                                  </div>
                                  <div>
                                    <Label className="text-white text-xs">
                                      Observações Internas
                                    </Label>
                                    <textarea
                                      value={newOrderForm.internalNotes}
                                      onChange={(e) =>
                                        handleFormChange(
                                          "internalNotes",
                                          e.target.value,
                                        )
                                      }
                                      className="w-full bg-cinema-gray border border-cinema-gray-light text-white rounded-md px-3 py-2 text-sm resize-none"
                                      rows={3}
                                      placeholder="Observações internas da equipe..."
                                    />
                                  </div>
                                </div>
                              </CardContent>
                            </Card>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                )}

                {/* View Order Modal */}
                {showViewOrderModal && selectedOrder && (
                  <div
                    className="fixed inset-0 bg-black/50 flex items-center justify-center z-50"
                    onClick={(e) => {
                      if (e.target === e.currentTarget) {
                        setShowViewOrderModal(false);
                      }
                    }}
                  >
                    <div
                      className="bg-cinema-gray border border-cinema-gray-light rounded-lg p-6 w-full max-w-2xl mx-4 max-h-[90vh] overflow-y-auto"
                      onClick={(e) => e.stopPropagation()}
                    >
                      <div className="flex justify-between items-center mb-6">
                        <h3 className="text-xl font-bold text-white">
                          Detalhes do Pedido {selectedOrder.id}
                        </h3>
                        <Button
                          variant="ghost"
                          size="sm"
                          onClick={(e) => {
                            e.preventDefault();
                            e.stopPropagation();
                            setShowViewOrderModal(false);
                          }}
                          className="text-gray-400 hover:text-white"
                        >
                          <X className="w-4 h-4" />
                        </Button>
                      </div>

                      <div className="space-y-6">
                        {/* Order Info */}
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                          <Card className="bg-cinema-dark border-cinema-gray-light">
                            <CardContent className="p-4">
                              <h4 className="text-cinema-yellow font-medium mb-3">
                                Informações do Pedido
                              </h4>
                              <div className="space-y-2">
                                <div className="flex justify-between">
                                  <span className="text-gray-400">ID:</span>
                                  <span className="text-white font-medium">
                                    {selectedOrder.id}
                                  </span>
                                </div>
                                <div className="flex justify-between">
                                  <span className="text-gray-400">Data:</span>
                                  <span className="text-white">
                                    {selectedOrder.date}
                                  </span>
                                </div>
                                <div className="flex justify-between">
                                  <span className="text-gray-400">Status:</span>
                                  <div
                                    className={`flex items-center ${getStatusColor(selectedOrder.status)}`}
                                  >
                                    {getStatusIcon(selectedOrder.status)}
                                    <span className="ml-1 text-sm capitalize">
                                      {selectedOrder.status}
                                    </span>
                                  </div>
                                </div>
                                <div className="flex justify-between">
                                  <span className="text-gray-400">
                                    Valor Total:
                                  </span>
                                  <span className="text-cinema-yellow font-bold">
                                    R$ {selectedOrder.total.toFixed(2)}
                                  </span>
                                </div>
                              </div>
                            </CardContent>
                          </Card>

                          <Card className="bg-cinema-dark border-cinema-gray-light">
                            <CardContent className="p-4">
                              <h4 className="text-cinema-yellow font-medium mb-3">
                                Informações do Cliente
                              </h4>
                              <div className="space-y-2">
                                <div className="flex justify-between">
                                  <span className="text-gray-400">Nome:</span>
                                  <span className="text-white">
                                    {selectedOrder.client}
                                  </span>
                                </div>
                                {selectedOrder.email && (
                                  <div className="flex justify-between">
                                    <span className="text-gray-400">
                                      E-mail:
                                    </span>
                                    <span className="text-white text-sm">
                                      {selectedOrder.email}
                                    </span>
                                  </div>
                                )}
                                {selectedOrder.phone && (
                                  <div className="flex justify-between">
                                    <span className="text-gray-400">
                                      Telefone:
                                    </span>
                                    <span className="text-white">
                                      {selectedOrder.phone}
                                    </span>
                                  </div>
                                )}
                              </div>
                            </CardContent>
                          </Card>
                        </div>

                        {/* Equipment */}
                        <Card className="bg-cinema-dark border-cinema-gray-light">
                          <CardContent className="p-4">
                            <h4 className="text-cinema-yellow font-medium mb-3">
                              Equipamentos
                            </h4>
                            <div className="space-y-2">
                              {selectedOrder.items.map(
                                (item: string, index: number) => (
                                  <div
                                    key={index}
                                    className="flex items-center justify-between p-2 bg-cinema-dark-lighter rounded"
                                  >
                                    <div className="flex items-center space-x-2">
                                      <Package className="w-4 h-4 text-cinema-yellow" />
                                      <span className="text-white">{item}</span>
                                    </div>
                                  </div>
                                ),
                              )}
                            </div>
                          </CardContent>
                        </Card>

                        {/* Dates */}
                        {(selectedOrder.pickupDate ||
                          selectedOrder.returnDate) && (
                          <Card className="bg-cinema-dark border-cinema-gray-light">
                            <CardContent className="p-4">
                              <h4 className="text-cinema-yellow font-medium mb-3">
                                Datas e Horários
                              </h4>
                              <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                {selectedOrder.pickupDate && (
                                  <div>
                                    <p className="text-gray-400 text-sm">
                                      Data de Retirada
                                    </p>
                                    <p className="text-white font-medium">
                                      {selectedOrder.pickupDate}
                                    </p>
                                    {selectedOrder.pickupTime && (
                                      <p className="text-gray-400 text-sm">
                                        Horário: {selectedOrder.pickupTime}
                                      </p>
                                    )}
                                  </div>
                                )}
                                {selectedOrder.returnDate && (
                                  <div>
                                    <p className="text-gray-400 text-sm">
                                      Data de Devolução
                                    </p>
                                    <p className="text-white font-medium">
                                      {selectedOrder.returnDate}
                                    </p>
                                    {selectedOrder.returnTime && (
                                      <p className="text-gray-400 text-sm">
                                        Horário: {selectedOrder.returnTime}
                                      </p>
                                    )}
                                  </div>
                                )}
                              </div>
                            </CardContent>
                          </Card>
                        )}

                        {/* Notes */}
                        {selectedOrder.notes && (
                          <Card className="bg-cinema-dark border-cinema-gray-light">
                            <CardContent className="p-4">
                              <h4 className="text-cinema-yellow font-medium mb-3">
                                Observações
                              </h4>
                              <p className="text-white">
                                {selectedOrder.notes}
                              </p>
                            </CardContent>
                          </Card>
                        )}

                        {/* Actions */}
                        <div className="space-y-3 pt-4">
                          {/* Status Actions */}
                          {selectedOrder.status === "ativo" && (
                            <div className="flex space-x-3">
                              <Button
                                className="flex-1 bg-green-500 text-white hover:bg-green-600"
                                onClick={(e) => {
                                  e.preventDefault();
                                  e.stopPropagation();
                                  handleCheckoutOrder(selectedOrder.id);
                                }}
                              >
                                <ArrowRight className="w-4 h-4 mr-2" />
                                Dar Saída
                              </Button>
                            </div>
                          )}

                          {selectedOrder.status === "em locação" && (
                            <div className="flex space-x-3">
                              <Button
                                className="flex-1 bg-blue-500 text-white hover:bg-blue-600"
                                onClick={(e) => {
                                  e.preventDefault();
                                  e.stopPropagation();
                                  handleReturnOrder(selectedOrder.id);
                                }}
                              >
                                <CheckCircle className="w-4 h-4 mr-2" />
                                Dar Devolução
                              </Button>
                            </div>
                          )}

                          {/* General Actions */}
                          <div className="flex space-x-3">
                            <Button
                              variant="outline"
                              className="flex-1 text-cinema-yellow border-cinema-yellow"
                            >
                              <Edit className="w-4 h-4 mr-2" />
                              Editar Pedido
                            </Button>
                            <Button
                              variant="outline"
                              className="flex-1 text-cinema-yellow border-cinema-yellow"
                            >
                              <Download className="w-4 h-4 mr-2" />
                              Download PDF
                            </Button>
                            <Button
                              variant="outline"
                              onClick={(e) => {
                                e.preventDefault();
                                e.stopPropagation();
                                setShowViewOrderModal(false);
                              }}
                              className="flex-1 text-gray-400 border-gray-400 hover:text-white hover:border-white"
                            >
                              Fechar
                            </Button>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                )}
              </div>
            )}

            {/* Estoque Tab */}
            {activeTab === "estoque" && (
              <div className="space-y-6">
                <div className="flex justify-between items-center">
                  <div>
                    <h2 className="text-3xl font-bold text-white">
                      Gestão de Estoque
                    </h2>
                    <p className="text-gray-400">
                      Gerencie seus {stockData.length} produtos, incluindo kits
                    </p>
                  </div>
                  <div className="flex space-x-2">
                    <Button
                      variant="outline"
                      className="text-cinema-yellow border-cinema-yellow"
                      onClick={() =>
                        setStockView(stockView === "grid" ? "list" : "grid")
                      }
                    >
                      {stockView === "grid" ? (
                        <Tag className="w-4 h-4 mr-2" />
                      ) : (
                        <Filter className="w-4 h-4 mr-2" />
                      )}
                      {stockView === "grid" ? "Lista" : "Grid"}
                    </Button>
                    <Button className="bg-cinema-yellow text-cinema-dark hover:bg-cinema-yellow-dark">
                      <Plus className="w-4 h-4 mr-2" />
                      Adicionar Produto
                    </Button>
                  </div>
                </div>

                {/* Advanced Search and Filters */}
                <Card className="bg-cinema-gray border-cinema-gray-light">
                  <CardContent className="p-6">
                    <div className="grid grid-cols-1 md:grid-cols-6 gap-4">
                      {/* Search */}
                      <div className="md:col-span-2">
                        <Label className="text-white text-sm">Pesquisar</Label>
                        <div className="relative">
                          <Search className="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4" />
                          <Input
                            placeholder="Nome, código, marca..."
                            value={stockSearch}
                            onChange={(e) => {
                              setStockSearch(e.target.value);
                              setCurrentPage(1);
                            }}
                            className="pl-10 bg-cinema-dark-lighter border-cinema-gray-light text-white"
                          />
                        </div>
                      </div>

                      {/* Category Filter */}
                      <div>
                        <Label className="text-white text-sm">Categoria</Label>
                        <select
                          value={stockCategoryFilter}
                          onChange={(e) => {
                            setStockCategoryFilter(e.target.value);
                            setCurrentPage(1);
                          }}
                          className="w-full bg-cinema-dark-lighter border border-cinema-gray-light text-white rounded-md px-3 py-2 text-sm"
                        >
                          <option value="todos">Todas</option>
                          {getUniqueCategories().map((category) => (
                            <option key={category} value={category}>
                              {category}
                            </option>
                          ))}
                        </select>
                      </div>

                      {/* Type Filter */}
                      <div>
                        <Label className="text-white text-sm">Tipo</Label>
                        <select
                          value={stockTypeFilter}
                          onChange={(e) => {
                            setStockTypeFilter(e.target.value);
                            setCurrentPage(1);
                          }}
                          className="w-full bg-cinema-dark-lighter border border-cinema-gray-light text-white rounded-md px-3 py-2 text-sm"
                        >
                          <option value="todos">Todos</option>
                          <option value="individual">Individual</option>
                          <option value="kit">Kit</option>
                        </select>
                      </div>

                      {/* Status Filter */}
                      <div>
                        <Label className="text-white text-sm">
                          Disponibilidade
                        </Label>
                        <select
                          value={stockStatusFilter}
                          onChange={(e) => {
                            setStockStatusFilter(e.target.value);
                            setCurrentPage(1);
                          }}
                          className="w-full bg-cinema-dark-lighter border border-cinema-gray-light text-white rounded-md px-3 py-2 text-sm"
                        >
                          <option value="todos">Todos</option>
                          <option value="disponivel">Disponível</option>
                          <option value="indisponivel">Indisponível</option>
                          <option value="em_locacao">Em Locação</option>
                        </select>
                      </div>

                      {/* Sort */}
                      <div>
                        <Label className="text-white text-sm">
                          Ordenar por
                        </Label>
                        <select
                          value={stockSort}
                          onChange={(e) => setStockSort(e.target.value)}
                          className="w-full bg-cinema-dark-lighter border border-cinema-gray-light text-white rounded-md px-3 py-2 text-sm"
                        >
                          <option value="name">Nome</option>
                          <option value="code">Código</option>
                          <option value="category">Categoria</option>
                          <option value="available">Disponibilidade</option>
                          <option value="price">Preço</option>
                        </select>
                      </div>
                    </div>

                    <div className="flex justify-between items-center mt-4 pt-4 border-t border-cinema-gray-light">
                      <div className="text-gray-400 text-sm">
                        Mostrando {getPaginatedStock().length} de{" "}
                        {getFilteredStock().length} produtos
                      </div>
                      <div className="flex space-x-2">
                        <Button
                          size="sm"
                          variant="outline"
                          onClick={() => {
                            setStockSearch("");
                            setStockCategoryFilter("todos");
                            setStockTypeFilter("todos");
                            setStockStatusFilter("todos");
                            setCurrentPage(1);
                          }}
                          className="text-gray-400 border-gray-400"
                        >
                          Limpar Filtros
                        </Button>
                      </div>
                    </div>
                  </CardContent>
                </Card>

                {/* Results */}
                {stockView === "grid" ? (
                  /* Grid View */
                  <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4">
                    {getPaginatedStock().map((item) => (
                      <Card
                        key={item.id}
                        className={`bg-cinema-gray border-cinema-gray-light ${item.isKit ? "border-l-4 border-l-purple-400" : ""}`}
                      >
                        <CardContent className="p-4">
                          <div className="flex justify-between items-start mb-3">
                            <div className="flex-1">
                              <div className="flex items-center gap-2 mb-1">
                                <h3 className="text-white font-semibold text-sm">
                                  {item.name}
                                </h3>
                                {item.isKit && (
                                  <span className="bg-purple-400/20 text-purple-400 text-xs px-2 py-1 rounded">
                                    KIT
                                  </span>
                                )}
                              </div>
                              <p className="text-gray-400 text-xs">
                                {item.code} • {item.brand}
                              </p>
                              <p className="text-gray-400 text-xs">
                                {item.category}
                              </p>
                            </div>
                            <div className="text-right">
                              <p className="text-lg font-bold text-cinema-yellow">
                                {item.available}
                              </p>
                              <p className="text-gray-400 text-xs">
                                disponível
                              </p>
                            </div>
                          </div>

                          {/* Status Mini Grid */}
                          <div className="grid grid-cols-3 gap-1 mb-3 text-center">
                            <div className="bg-cinema-dark-lighter rounded p-1">
                              <p className="text-green-400 font-bold text-sm">
                                {item.available}
                              </p>
                              <p className="text-xs text-gray-400">Disp.</p>
                            </div>
                            <div className="bg-cinema-dark-lighter rounded p-1">
                              <p className="text-blue-400 font-bold text-sm">
                                {item.reserved}
                              </p>
                              <p className="text-xs text-gray-400">Loc.</p>
                            </div>
                            <div className="bg-cinema-dark-lighter rounded p-1">
                              <p className="text-cinema-yellow font-bold text-sm">
                                {item.total}
                              </p>
                              <p className="text-xs text-gray-400">Total</p>
                            </div>
                          </div>

                          {/* Kit Items */}
                          {item.isKit && item.kitItems.length > 0 && (
                            <div className="mb-3">
                              <p className="text-gray-400 text-xs mb-1">
                                Itens do kit:
                              </p>
                              <div className="text-xs text-gray-300">
                                {item.kitItems
                                  .slice(0, 2)
                                  .map((kitItem, idx) => (
                                    <div key={idx}>• {kitItem}</div>
                                  ))}
                                {item.kitItems.length > 2 && (
                                  <div className="text-cinema-yellow">
                                    +{item.kitItems.length - 2} mais...
                                  </div>
                                )}
                              </div>
                            </div>
                          )}

                          <div className="w-full bg-cinema-dark-lighter rounded-full h-1 mb-3">
                            <div
                              className="bg-cinema-yellow h-1 rounded-full"
                              style={{
                                width: `${(item.available / item.total) * 100}%`,
                              }}
                            ></div>
                          </div>

                          <div className="flex justify-between items-center">
                            <span className="text-cinema-yellow font-medium text-sm">
                              R$ {item.price.toFixed(2)}
                            </span>
                            <div className="flex space-x-1">
                              <Button
                                size="sm"
                                variant="outline"
                                className="text-cinema-yellow border-cinema-yellow h-7 w-7 p-0"
                              >
                                <Eye className="w-3 h-3" />
                              </Button>
                              <Button
                                size="sm"
                                variant="outline"
                                className="text-cinema-yellow border-cinema-yellow h-7 w-7 p-0"
                              >
                                <Edit className="w-3 h-3" />
                              </Button>
                            </div>
                          </div>
                        </CardContent>
                      </Card>
                    ))}
                  </div>
                ) : (
                  /* List View */
                  <Card className="bg-cinema-gray border-cinema-gray-light">
                    <CardContent className="p-0">
                      <div className="overflow-x-auto">
                        <table className="w-full">
                          <thead className="border-b border-cinema-gray-light">
                            <tr>
                              <th className="px-4 py-3 text-left text-cinema-yellow font-medium text-sm">
                                Código
                              </th>
                              <th className="px-4 py-3 text-left text-cinema-yellow font-medium text-sm">
                                Nome
                              </th>
                              <th className="px-4 py-3 text-left text-cinema-yellow font-medium text-sm">
                                Categoria
                              </th>
                              <th className="px-4 py-3 text-left text-cinema-yellow font-medium text-sm">
                                Tipo
                              </th>
                              <th className="px-4 py-3 text-left text-cinema-yellow font-medium text-sm">
                                Disponível
                              </th>
                              <th className="px-4 py-3 text-left text-cinema-yellow font-medium text-sm">
                                Em Locação
                              </th>
                              <th className="px-4 py-3 text-left text-cinema-yellow font-medium text-sm">
                                Total
                              </th>
                              <th className="px-4 py-3 text-left text-cinema-yellow font-medium text-sm">
                                Preço
                              </th>
                              <th className="px-4 py-3 text-left text-cinema-yellow font-medium text-sm">
                                Ações
                              </th>
                            </tr>
                          </thead>
                          <tbody>
                            {getPaginatedStock().map((item) => (
                              <tr
                                key={item.id}
                                className="border-b border-cinema-gray-light hover:bg-cinema-dark-lighter"
                              >
                                <td className="px-4 py-3 text-white font-medium text-sm">
                                  {item.code}
                                </td>
                                <td className="px-4 py-3">
                                  <div className="flex items-center gap-2">
                                    <span className="text-white text-sm">
                                      {item.name}
                                    </span>
                                    {item.isKit && (
                                      <span className="bg-purple-400/20 text-purple-400 text-xs px-2 py-1 rounded">
                                        KIT
                                      </span>
                                    )}
                                  </div>
                                  <p className="text-gray-400 text-xs">
                                    {item.brand}
                                  </p>
                                </td>
                                <td className="px-4 py-3 text-gray-400 text-sm">
                                  {item.category}
                                </td>
                                <td className="px-4 py-3">
                                  <span
                                    className={`px-2 py-1 rounded text-xs ${
                                      item.isKit
                                        ? "bg-purple-400/20 text-purple-400"
                                        : "bg-blue-400/20 text-blue-400"
                                    }`}
                                  >
                                    {item.isKit ? "Kit" : "Individual"}
                                  </span>
                                </td>
                                <td className="px-4 py-3 text-green-400 font-medium">
                                  {item.available}
                                </td>
                                <td className="px-4 py-3 text-blue-400 font-medium">
                                  {item.reserved}
                                </td>
                                <td className="px-4 py-3 text-cinema-yellow font-medium">
                                  {item.total}
                                </td>
                                <td className="px-4 py-3 text-cinema-yellow font-medium">
                                  R$ {item.price.toFixed(2)}
                                </td>
                                <td className="px-4 py-3">
                                  <div className="flex space-x-2">
                                    <Button
                                      size="sm"
                                      variant="outline"
                                      className="text-cinema-yellow border-cinema-yellow"
                                    >
                                      <Eye className="w-4 h-4" />
                                    </Button>
                                    <Button
                                      size="sm"
                                      variant="outline"
                                      className="text-cinema-yellow border-cinema-yellow"
                                    >
                                      <Edit className="w-4 h-4" />
                                    </Button>
                                  </div>
                                </td>
                              </tr>
                            ))}
                          </tbody>
                        </table>
                      </div>
                    </CardContent>
                  </Card>
                )}

                {/* Pagination */}
                {getTotalPages() > 1 && (
                  <div className="flex justify-center items-center space-x-2">
                    <Button
                      size="sm"
                      variant="outline"
                      onClick={() =>
                        setCurrentPage(Math.max(1, currentPage - 1))
                      }
                      disabled={currentPage === 1}
                      className="text-cinema-yellow border-cinema-yellow disabled:opacity-50"
                    >
                      Anterior
                    </Button>

                    <div className="flex space-x-1">
                      {Array.from(
                        { length: getTotalPages() },
                        (_, i) => i + 1,
                      ).map((page) => (
                        <Button
                          key={page}
                          size="sm"
                          variant={currentPage === page ? "default" : "outline"}
                          onClick={() => setCurrentPage(page)}
                          className={
                            currentPage === page
                              ? "bg-cinema-yellow text-cinema-dark"
                              : "text-cinema-yellow border-cinema-yellow"
                          }
                        >
                          {page}
                        </Button>
                      ))}
                    </div>

                    <Button
                      size="sm"
                      variant="outline"
                      onClick={() =>
                        setCurrentPage(
                          Math.min(getTotalPages(), currentPage + 1),
                        )
                      }
                      disabled={currentPage === getTotalPages()}
                      className="text-cinema-yellow border-cinema-yellow disabled:opacity-50"
                    >
                      Próxima
                    </Button>
                  </div>
                )}
              </div>
            )}

            {/* Produtos Tab */}
            {activeTab === "produtos" && (
              <div className="space-y-6">
                <h2 className="text-3xl font-bold text-white">
                  Gestão de Produtos
                </h2>

                {/* Products Management */}
                <div className="bg-cinema-gray border border-cinema-gray-light rounded-lg">
                  <div className="h-[600px]">
                    <ProductManager mode="manage" onProductSelect={() => {}} />
                  </div>
                </div>
              </div>
            )}

            {/* Categorias Tab */}
            {activeTab === "categorias" && (
              <div className="space-y-6">
                <h2 className="text-3xl font-bold text-white">
                  Gestão de Categorias
                </h2>

                {/* Categories Management */}
                <div className="bg-cinema-gray border border-cinema-gray-light rounded-lg">
                  <div className="h-[600px]">
                    <CategoryManager />
                  </div>
                </div>
              </div>
            )}

            {/* Clientes/Fornecedores Tab */}
            {activeTab === "clientes" && (
              <div className="space-y-6">
                <div className="flex justify-between items-center">
                  <h2 className="text-3xl font-bold text-white">
                    Clientes e Fornecedores
                  </h2>
                  <Button
                    className="bg-cinema-yellow text-cinema-dark hover:bg-cinema-yellow-dark"
                    onClick={() => setShowClientModal(true)}
                  >
                    <Plus className="w-4 h-4 mr-2" />
                    Novo Cliente
                  </Button>
                </div>

                {/* Clients Table */}
                <Card className="bg-cinema-gray border-cinema-gray-light">
                  <CardContent className="p-0">
                    <div className="overflow-x-auto">
                      <table className="w-full">
                        <thead className="border-b border-cinema-gray-light">
                          <tr>
                            <th className="px-6 py-4 text-left text-cinema-yellow font-medium">
                              ID
                            </th>
                            <th className="px-6 py-4 text-left text-cinema-yellow font-medium">
                              Nome
                            </th>
                            <th className="px-6 py-4 text-left text-cinema-yellow font-medium">
                              E-mail
                            </th>
                            <th className="px-6 py-4 text-left text-cinema-yellow font-medium">
                              Tipo
                            </th>
                            <th className="px-6 py-4 text-left text-cinema-yellow font-medium">
                              Empresa
                            </th>
                            <th className="px-6 py-4 text-left text-cinema-yellow font-medium">
                              Pedidos
                            </th>
                            <th className="px-6 py-4 text-left text-cinema-yellow font-medium">
                              Ações
                            </th>
                          </tr>
                        </thead>
                        <tbody>
                          {clientsData.map((client) => (
                            <tr
                              key={client.id}
                              className="border-b border-cinema-gray-light hover:bg-cinema-dark-lighter"
                            >
                              <td className="px-6 py-4 text-white font-medium">
                                {client.id}
                              </td>
                              <td className="px-6 py-4 text-white">
                                {client.name}
                              </td>
                              <td className="px-6 py-4 text-gray-400">
                                {client.email}
                              </td>
                              <td className="px-6 py-4">
                                <span
                                  className={`px-2 py-1 rounded text-xs ${
                                    client.type === "cliente"
                                      ? "bg-blue-400/20 text-blue-400"
                                      : client.type === "fornecedor"
                                        ? "bg-green-400/20 text-green-400"
                                        : "bg-cinema-yellow/20 text-cinema-yellow"
                                  }`}
                                >
                                  {client.type === "ambos"
                                    ? "Cliente + Fornecedor"
                                    : client.type === "cliente"
                                      ? "Cliente"
                                      : "Fornecedor"}
                                </span>
                              </td>
                              <td className="px-6 py-4 text-gray-400">
                                {client.company || "-"}
                              </td>
                              <td className="px-6 py-4 text-white">
                                {client.totalOrders}
                              </td>
                              <td className="px-6 py-4">
                                <div className="flex space-x-2">
                                  <Button
                                    size="sm"
                                    variant="outline"
                                    className="text-cinema-yellow border-cinema-yellow"
                                  >
                                    <Edit className="w-4 h-4" />
                                  </Button>
                                  <Button
                                    size="sm"
                                    variant="outline"
                                    className="text-cinema-yellow border-cinema-yellow"
                                  >
                                    <Eye className="w-4 h-4" />
                                  </Button>
                                </div>
                              </td>
                            </tr>
                          ))}
                        </tbody>
                      </table>
                    </div>
                  </CardContent>
                </Card>

                {/* Client Modal */}
                {showClientModal && (
                  <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50">
                    <div className="bg-cinema-gray border border-cinema-gray-light rounded-lg p-6 w-full max-w-lg mx-4">
                      <div className="flex justify-between items-center mb-6">
                        <h3 className="text-xl font-bold text-white">
                          Novo Cliente/Fornecedor
                        </h3>
                        <Button
                          variant="ghost"
                          size="sm"
                          onClick={() => setShowClientModal(false)}
                          className="text-gray-400 hover:text-white"
                        >
                          <X className="w-4 h-4" />
                        </Button>
                      </div>

                      <form onSubmit={handleClientSubmit} className="space-y-4">
                        <div>
                          <Label htmlFor="clientName" className="text-white">
                            Nome
                          </Label>
                          <Input
                            id="clientName"
                            value={clientForm.name}
                            onChange={(e) =>
                              handleClientFormChange("name", e.target.value)
                            }
                            className="bg-cinema-dark-lighter border-cinema-gray-light text-white"
                            required
                          />
                        </div>

                        <div>
                          <Label htmlFor="clientEmail" className="text-white">
                            E-mail
                          </Label>
                          <Input
                            id="clientEmail"
                            type="email"
                            value={clientForm.email}
                            onChange={(e) =>
                              handleClientFormChange("email", e.target.value)
                            }
                            className="bg-cinema-dark-lighter border-cinema-gray-light text-white"
                            required
                          />
                        </div>

                        <div>
                          <Label htmlFor="clientPhone" className="text-white">
                            Telefone
                          </Label>
                          <Input
                            id="clientPhone"
                            value={clientForm.phone}
                            onChange={(e) =>
                              handleClientFormChange("phone", e.target.value)
                            }
                            className="bg-cinema-dark-lighter border-cinema-gray-light text-white"
                            required
                          />
                        </div>

                        <div>
                          <Label htmlFor="clientType" className="text-white">
                            Tipo
                          </Label>
                          <select
                            id="clientType"
                            value={clientForm.type}
                            onChange={(e) =>
                              handleClientFormChange("type", e.target.value)
                            }
                            className="w-full bg-cinema-dark-lighter border border-cinema-gray-light text-white rounded-md px-3 py-2"
                          >
                            <option value="cliente">Cliente</option>
                            <option value="fornecedor">Fornecedor</option>
                            <option value="ambos">Cliente + Fornecedor</option>
                          </select>
                        </div>

                        <div>
                          <Label htmlFor="clientCompany" className="text-white">
                            Empresa (opcional)
                          </Label>
                          <Input
                            id="clientCompany"
                            value={clientForm.company}
                            onChange={(e) =>
                              handleClientFormChange("company", e.target.value)
                            }
                            className="bg-cinema-dark-lighter border-cinema-gray-light text-white"
                            placeholder="Nome da empresa"
                          />
                        </div>

                        <div className="flex space-x-3 pt-4">
                          <Button
                            type="submit"
                            className="flex-1 bg-cinema-yellow text-cinema-dark hover:bg-cinema-yellow-dark"
                          >
                            Cadastrar
                          </Button>
                          <Button
                            type="button"
                            variant="outline"
                            onClick={() => setShowClientModal(false)}
                            className="flex-1 text-gray-400 border-gray-400 hover:text-white hover:border-white"
                          >
                            Cancelar
                          </Button>
                        </div>
                      </form>
                    </div>
                  </div>
                )}
              </div>
            )}

            {/* Serviços Tab */}
            {activeTab === "servicos" && (
              <div className="space-y-6">
                <div className="flex justify-between items-center">
                  <h2 className="text-3xl font-bold text-white">
                    Gestão de Serviços
                  </h2>
                  <Button
                    className="bg-cinema-yellow text-cinema-dark hover:bg-cinema-yellow-dark"
                    onClick={() => setShowServiceModal(true)}
                  >
                    <Plus className="w-4 h-4 mr-2" />
                    Novo Serviço
                  </Button>
                </div>

                {/* Services Grid */}
                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                  {servicesData.map((service) => (
                    <Card
                      key={service.id}
                      className="bg-cinema-gray border-cinema-gray-light"
                    >
                      <CardContent className="p-6">
                        <div className="flex justify-between items-start mb-4">
                          <div>
                            <h3 className="text-white font-semibold text-lg">
                              {service.name}
                            </h3>
                            <p className="text-gray-400 text-sm">
                              {service.category}
                            </p>
                          </div>
                          <span
                            className={`px-2 py-1 rounded text-xs ${
                              service.active
                                ? "bg-green-400/20 text-green-400"
                                : "bg-red-400/20 text-red-400"
                            }`}
                          >
                            {service.active ? "Ativo" : "Inativo"}
                          </span>
                        </div>

                        <p className="text-gray-400 text-sm mb-4">
                          {service.description}
                        </p>

                        <div className="space-y-2 mb-4">
                          <div className="flex justify-between">
                            <span className="text-gray-400 text-sm">
                              Preço:
                            </span>
                            <span className="text-cinema-yellow font-medium">
                              R$ {service.price.toFixed(2)}
                            </span>
                          </div>
                          <div className="flex justify-between">
                            <span className="text-gray-400 text-sm">
                              Duração:
                            </span>
                            <span className="text-white text-sm">
                              {service.duration}
                            </span>
                          </div>
                        </div>

                        <div className="flex space-x-2">
                          <Button
                            size="sm"
                            variant="outline"
                            className="flex-1 text-cinema-yellow border-cinema-yellow"
                          >
                            <Edit className="w-4 h-4 mr-1" />
                            Editar
                          </Button>
                          <Button
                            size="sm"
                            variant="outline"
                            className="text-red-400 border-red-400"
                          >
                            <Trash2 className="w-4 h-4" />
                          </Button>
                        </div>
                      </CardContent>
                    </Card>
                  ))}
                </div>

                {/* Service Modal */}
                {showServiceModal && (
                  <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50">
                    <div className="bg-cinema-gray border border-cinema-gray-light rounded-lg p-6 w-full max-w-lg mx-4">
                      <div className="flex justify-between items-center mb-6">
                        <h3 className="text-xl font-bold text-white">
                          Novo Serviço
                        </h3>
                        <Button
                          variant="ghost"
                          size="sm"
                          onClick={() => setShowServiceModal(false)}
                          className="text-gray-400 hover:text-white"
                        >
                          <X className="w-4 h-4" />
                        </Button>
                      </div>

                      <form
                        onSubmit={handleServiceSubmit}
                        className="space-y-4"
                      >
                        <div>
                          <Label htmlFor="serviceName" className="text-white">
                            Nome do Serviço
                          </Label>
                          <Input
                            id="serviceName"
                            value={serviceForm.name}
                            onChange={(e) =>
                              handleServiceFormChange("name", e.target.value)
                            }
                            className="bg-cinema-dark-lighter border-cinema-gray-light text-white"
                            required
                          />
                        </div>

                        <div>
                          <Label
                            htmlFor="serviceCategory"
                            className="text-white"
                          >
                            Categoria
                          </Label>
                          <select
                            id="serviceCategory"
                            value={serviceForm.category}
                            onChange={(e) =>
                              handleServiceFormChange(
                                "category",
                                e.target.value,
                              )
                            }
                            className="w-full bg-cinema-dark-lighter border border-cinema-gray-light text-white rounded-md px-3 py-2"
                          >
                            <option value="Gravação">Gravação</option>
                            <option value="Produção">Produção</option>
                            <option value="Pós-Produção">Pós-Produção</option>
                            <option value="Streaming">Streaming</option>
                            <option value="Fotografia">Fotografia</option>
                            <option value="Consultoria">Consultoria</option>
                          </select>
                        </div>

                        <div>
                          <Label
                            htmlFor="serviceDescription"
                            className="text-white"
                          >
                            Descrição
                          </Label>
                          <textarea
                            id="serviceDescription"
                            value={serviceForm.description}
                            onChange={(e) =>
                              handleServiceFormChange(
                                "description",
                                e.target.value,
                              )
                            }
                            className="w-full bg-cinema-dark-lighter border border-cinema-gray-light text-white rounded-md px-3 py-2 h-20 resize-none"
                            required
                          />
                        </div>

                        <div className="grid grid-cols-2 gap-4">
                          <div>
                            <Label
                              htmlFor="servicePrice"
                              className="text-white"
                            >
                              Preço (R$)
                            </Label>
                            <Input
                              id="servicePrice"
                              type="number"
                              step="0.01"
                              value={serviceForm.price}
                              onChange={(e) =>
                                handleServiceFormChange("price", e.target.value)
                              }
                              className="bg-cinema-dark-lighter border-cinema-gray-light text-white"
                              required
                            />
                          </div>
                          <div>
                            <Label
                              htmlFor="serviceDuration"
                              className="text-white"
                            >
                              Duração
                            </Label>
                            <Input
                              id="serviceDuration"
                              value={serviceForm.duration}
                              onChange={(e) =>
                                handleServiceFormChange(
                                  "duration",
                                  e.target.value,
                                )
                              }
                              className="bg-cinema-dark-lighter border-cinema-gray-light text-white"
                              placeholder="Ex: 4 horas, 1 dia"
                              required
                            />
                          </div>
                        </div>

                        <div className="flex space-x-3 pt-4">
                          <Button
                            type="submit"
                            className="flex-1 bg-cinema-yellow text-cinema-dark hover:bg-cinema-yellow-dark"
                          >
                            Criar Serviço
                          </Button>
                          <Button
                            type="button"
                            variant="outline"
                            onClick={() => setShowServiceModal(false)}
                            className="flex-1 text-gray-400 border-gray-400 hover:text-white hover:border-white"
                          >
                            Cancelar
                          </Button>
                        </div>
                      </form>
                    </div>
                  </div>
                )}
              </div>
            )}

            {/* E-commerce Customization Tab */}
            {activeTab === "ecommerce" && (
              <div className="space-y-6">
                <h2 className="text-3xl font-bold text-white">E-commerce</h2>

                {/* Editor Section */}
                <Card className="bg-cinema-gray border-cinema-gray-light">
                  <CardHeader>
                    <CardTitle className="text-white">
                      Editor de Aparência
                    </CardTitle>
                  </CardHeader>
                  <CardContent className="space-y-6">
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                      <div>
                        <Label className="text-white mb-2 block">
                          Logo da Empresa
                        </Label>
                        <div className="border-2 border-dashed border-cinema-gray-light rounded-lg p-8 text-center">
                          {currentLogo ? (
                            <div className="mb-4">
                              <img
                                src={currentLogo}
                                alt="Logo atual"
                                className="max-h-24 mx-auto object-contain"
                              />
                            </div>
                          ) : (
                            <Upload className="w-8 h-8 text-gray-400 mx-auto mb-2" />
                          )}
                          <p className="text-gray-400 text-sm">
                            {currentLogo
                              ? "Logo atual"
                              : "Clique para enviar novo logo"}
                          </p>
                          <Button
                            className="mt-2 bg-cinema-yellow text-cinema-dark hover:bg-cinema-yellow-dark"
                            onClick={handleLogoUpload}
                          >
                            Alterar Logo
                          </Button>
                        </div>
                      </div>

                      <div>
                        <Label className="text-white mb-2 block">
                          Banner Principal
                        </Label>
                        <div className="border-2 border-dashed border-cinema-gray-light rounded-lg p-8 text-center">
                          {currentBanner ? (
                            <div className="mb-4">
                              <img
                                src={currentBanner}
                                alt="Banner atual"
                                className="max-h-24 mx-auto object-contain"
                              />
                            </div>
                          ) : (
                            <Camera className="w-8 h-8 text-gray-400 mx-auto mb-2" />
                          )}
                          <p className="text-gray-400 text-sm">
                            {currentBanner
                              ? "Banner atual"
                              : "Banner da página inicial"}
                          </p>
                          <Button
                            className="mt-2 bg-cinema-yellow text-cinema-dark hover:bg-cinema-yellow-dark"
                            onClick={handleBannerUpload}
                          >
                            Alterar Banner
                          </Button>
                        </div>
                      </div>
                    </div>

                    <Separator className="bg-cinema-gray-light" />

                    <div>
                      <Button
                        size="lg"
                        className="bg-cinema-yellow text-cinema-dark hover:bg-cinema-yellow-dark"
                        onClick={() => setShowEditorModal(true)}
                      >
                        <Palette className="w-5 h-5 mr-2" />
                        Abrir Editor Drag & Drop
                        <ArrowRight className="w-5 h-5 ml-2" />
                      </Button>
                      <p className="text-gray-400 text-sm mt-2">
                        Editor visual avançado para personalizar completamente a
                        aparência do site
                      </p>
                    </div>
                  </CardContent>
                </Card>

                {/* Premium Features */}
                <Card className="bg-cinema-gray border-cinema-gray-light">
                  <CardHeader>
                    <CardTitle className="text-white">
                      Recursos Premium
                    </CardTitle>
                  </CardHeader>
                  <CardContent className="space-y-4">
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div className="flex items-center justify-between p-4 bg-cinema-dark-lighter rounded-lg">
                        <div className="flex items-center space-x-3">
                          <Calendar className="w-5 h-5 text-cinema-yellow" />
                          <div>
                            <h4 className="text-white font-medium">
                              Integração Google Agenda
                            </h4>
                            <p className="text-gray-400 text-sm">
                              Sincronizar reservas automaticamente
                            </p>
                          </div>
                        </div>
                        <Button
                          variant="outline"
                          className="text-cinema-yellow border-cinema-yellow"
                        >
                          Ativar
                        </Button>
                      </div>

                      <div className="flex items-center justify-between p-4 bg-cinema-dark-lighter rounded-lg">
                        <div className="flex items-center space-x-3">
                          <QrCode className="w-5 h-5 text-cinema-yellow" />
                          <div>
                            <h4 className="text-white font-medium">
                              QR Code Check-in
                            </h4>
                            <p className="text-gray-400 text-sm">
                              Check-in e check-out por QR Code
                            </p>
                          </div>
                        </div>
                        <Button
                          variant="outline"
                          className="text-cinema-yellow border-cinema-yellow"
                        >
                          Ativar
                        </Button>
                      </div>

                      <div className="flex items-center justify-between p-4 bg-cinema-dark-lighter rounded-lg">
                        <div className="flex items-center space-x-3">
                          <Star className="w-5 h-5 text-cinema-yellow" />
                          <div>
                            <h4 className="text-white font-medium">
                              Sistema de Fidelidade
                            </h4>
                            <p className="text-gray-400 text-sm">
                              Pontos e recompensas para clientes
                            </p>
                          </div>
                        </div>
                        <Button
                          variant="outline"
                          className="text-red-400 border-red-400"
                        >
                          Desativado
                        </Button>
                      </div>

                      <div className="flex items-center justify-between p-4 bg-cinema-dark-lighter rounded-lg">
                        <div className="flex items-center space-x-3">
                          <Bell className="w-5 h-5 text-cinema-yellow" />
                          <div>
                            <h4 className="text-white font-medium">
                              Notificações SMS
                            </h4>
                            <p className="text-gray-400 text-sm">
                              Lembretes automáticos por SMS
                            </p>
                          </div>
                        </div>
                        <Button
                          variant="outline"
                          className="text-cinema-yellow border-cinema-yellow"
                        >
                          Ativo
                        </Button>
                      </div>
                    </div>
                  </CardContent>
                </Card>
              </div>
            )}

            {/* Advanced Editor Modal */}
            {showEditorModal && (
              <AdvancedPageEditor onClose={() => setShowEditorModal(false)} />
            )}

            {/* Documentos Tab */}
            {activeTab === "documentos" && (
              <div className="space-y-6">
                <h2 className="text-3xl font-bold text-white">
                  Gestão de Documentos
                </h2>

                <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                  {/* Company Documents */}
                  <Card className="bg-cinema-gray border-cinema-gray-light">
                    <CardHeader>
                      <CardTitle className="text-white">
                        Documentos da Locadora
                      </CardTitle>
                    </CardHeader>
                    <CardContent className="space-y-4">
                      <div className="p-4 bg-cinema-dark-lighter rounded-lg">
                        <div className="flex justify-between items-center mb-2">
                          <h4 className="text-white font-medium">CNPJ</h4>
                          <CheckCircle className="w-5 h-5 text-green-400" />
                        </div>
                        <p className="text-gray-400 text-sm">
                          Validade: 2025-12-31
                        </p>
                      </div>

                      <div className="p-4 bg-cinema-dark-lighter rounded-lg">
                        <div className="flex justify-between items-center mb-2">
                          <h4 className="text-white font-medium">
                            Alvará de Funcionamento
                          </h4>
                          <CheckCircle className="w-5 h-5 text-green-400" />
                        </div>
                        <p className="text-gray-400 text-sm">
                          Validade: 2025-06-30
                        </p>
                      </div>

                      <div className="p-4 bg-cinema-dark-lighter rounded-lg">
                        <div className="flex justify-between items-center mb-2">
                          <h4 className="text-white font-medium">
                            Seguro de Equipamentos
                          </h4>
                          <AlertTriangle className="w-5 h-5 text-yellow-400" />
                        </div>
                        <p className="text-gray-400 text-sm">
                          Vence em 30 dias
                        </p>
                      </div>

                      <Button className="w-full bg-cinema-yellow text-cinema-dark hover:bg-cinema-yellow-dark">
                        <Upload className="w-4 h-4 mr-2" />
                        Enviar Documento
                      </Button>
                    </CardContent>
                  </Card>

                  {/* Digital Certificates */}
                  <Card className="bg-cinema-gray border-cinema-gray-light">
                    <CardHeader>
                      <CardTitle className="text-white">
                        Certificados Digitais
                      </CardTitle>
                    </CardHeader>
                    <CardContent className="space-y-4">
                      <div className="p-4 bg-cinema-dark-lighter rounded-lg">
                        <div className="flex justify-between items-center mb-2">
                          <h4 className="text-white font-medium">
                            Certificado A1
                          </h4>
                          <CheckCircle className="w-5 h-5 text-green-400" />
                        </div>
                        <p className="text-gray-400 text-sm">
                          Instalado e válido
                        </p>
                        <p className="text-gray-400 text-xs">
                          Validade: 2025-11-15
                        </p>
                      </div>

                      <div className="p-4 bg-cinema-dark-lighter rounded-lg">
                        <div className="flex justify-between items-center mb-2">
                          <h4 className="text-white font-medium">
                            NFe Homologação
                          </h4>
                          <XCircle className="w-5 h-5 text-red-400" />
                        </div>
                        <p className="text-gray-400 text-sm">
                          Configuração pendente
                        </p>
                      </div>

                      <Button
                        className="w-full text-cinema-yellow border-cinema-yellow"
                        variant="outline"
                      >
                        <Settings className="w-4 h-4 mr-2" />
                        Configurar Certificados
                      </Button>
                    </CardContent>
                  </Card>
                </div>
              </div>
            )}

            {/* Financeiro Tab */}
            {activeTab === "financeiro" &&
              (isFuncionario ? (
                <div className="space-y-6">
                  <h2 className="text-3xl font-bold text-white">
                    Acesso Negado
                  </h2>
                  <div className="bg-cinema-gray border border-cinema-gray-light rounded-lg p-6">
                    <p className="text-gray-400">
                      Seu usuário não tem permissão para acessar o módulo
                      financeiro.
                    </p>
                  </div>
                </div>
              ) : (
                <div className="space-y-6">
                  <h2 className="text-3xl font-bold text-white">
                    Sistema Financeiro
                  </h2>

                  {/* Finance Management */}
                  <div className="bg-cinema-gray border border-cinema-gray-light rounded-lg">
                    <div className="h-[700px]">
                      <FinancialERP />
                    </div>
                  </div>
                </div>
              ))}

            {/* Importar Tab */}
            {activeTab === "importar" && (
              <div className="space-y-6">
                <h2 className="text-3xl font-bold text-white">
                  Importação de Dados
                </h2>

                {/* Import Management */}
                <div className="bg-cinema-gray border border-cinema-gray-light rounded-lg">
                  <div className="h-[700px]">
                    <ImportManager />
                  </div>
                </div>
              </div>
            )}

            {/* Multi-Tenant Branding Tab */}
            {activeTab === "multi-tenant" && (
              <div className="bg-cinema-gray border border-cinema-gray-light rounded-lg">
                <div className="h-[700px] overflow-y-auto">
                  <MultiTenantPlaceholder />
                </div>
              </div>
            )}

            {/* Templates Tab */}
            {activeTab === "templates" && (
              <div className="bg-cinema-gray border border-cinema-gray-light rounded-lg">
                <div className="h-[700px] overflow-y-auto">
                  <TemplateManager />
                </div>
              </div>
            )}

            {/* Funcionários Tab */}
            {activeTab === "funcionarios" && (
              <div className="space-y-6">
                <EmployeeManager />
              </div>
            )}

            {/* Ponto Automático Tab */}
            {activeTab === "auto-ponto" && (
              <div className="space-y-6">
                <div className="flex justify-between items-center">
                  <h2 className="text-3xl font-bold text-white">Sistema de Ponto Automático</h2>
                  <Badge className="bg-green-600 text-white">
                    <Clock className="w-4 h-4 mr-1" />
                    Sistema Ativo
                  </Badge>
                </div>

                <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                  {/* Sistema de Ponto */}
                  <div>
                    <AutoTimesheetSystem />
                  </div>
                  
                  {/* Dashboard de Atividades */}
                  <div>
                    <ManagerActivityDashboard />
                  </div>
                </div>

                {/* Funcionalidades do Sistema */}
                <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                  <Card className="bg-gray-800 border-gray-700">
                    <CardHeader>
                      <CardTitle className="flex items-center text-white">
                        <MapPin className="w-5 h-5 mr-2 text-blue-400" />
                        Localização GPS
                      </CardTitle>
                    </CardHeader>
                    <CardContent>
                      <ul className="text-gray-300 text-sm space-y-2">
                        <li>• Detecção automática da localização</li>
                        <li>• Raio de 100m da empresa</li>
                        <li>• Trabalho remoto identificado</li>
                        <li>• Precisão em tempo real</li>
                      </ul>
                    </CardContent>
                  </Card>

                  <Card className="bg-gray-800 border-gray-700">
                    <CardHeader>
                      <CardTitle className="flex items-center text-white">
                        <Clock className="w-5 h-5 mr-2 text-green-400" />
                        Horários Inteligentes
                      </CardTitle>
                    </CardHeader>
                    <CardContent>
                      <ul className="text-gray-300 text-sm space-y-2">
                        <li>• Horário de trabalho configurável</li>
                        <li>• Detecção de horas extras</li>
                        <li>• Aprovação automática na empresa</li>
                        <li>• Controle por dia da semana</li>
                      </ul>
                    </CardContent>
                  </Card>

                  <Card className="bg-gray-800 border-gray-700">
                    <CardHeader>
                      <CardTitle className="flex items-center text-white">
                        <Activity className="w-5 h-5 mr-2 text-purple-400" />
                        Monitoramento
                      </CardTitle>
                    </CardHeader>
                    <CardContent>
                      <ul className="text-gray-300 text-sm space-y-2">
                        <li>• Log de todas as atividades</li>
                        <li>• Pedidos e alterações</li>
                        <li>• Localização de cada ação</li>
                        <li>• Relatórios detalhados</li>
                      </ul>
                    </CardContent>
                  </Card>
                </div>

                {/* Instruções de Uso */}
                <Card className="bg-blue-900/20 border-blue-500/50">
                  <CardHeader>
                    <CardTitle className="text-blue-400">📋 Como Funciona o Sistema</CardTitle>
                  </CardHeader>
                  <CardContent className="text-gray-300">
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                      <div>
                        <h4 className="text-white font-semibold mb-2">Para Funcionários:</h4>
                        <ul className="space-y-1 text-sm">
                          <li>• Login automático registra entrada</li>
                          <li>• GPS detecta se está na empresa</li>
                          <li>• Dentro da empresa = aprovação automática</li>
                          <li>• Fora da empresa = aguarda aprovação</li>
                          <li>• Todas as ações são monitoradas</li>
                        </ul>
                      </div>
                      <div>
                        <h4 className="text-white font-semibold mb-2">Para Gestores:</h4>
                        <ul className="space-y-1 text-sm">
                          <li>• Visualiza todos os funcionários online</li>
                          <li>• Aprova pontos fora da empresa</li>
                          <li>• Monitora atividades em tempo real</li>
                          <li>• Relatórios de localização</li>
                          <li>• Controle total do sistema</li>
                        </ul>
                      </div>
                    </div>
                  </CardContent>
                </Card>
              </div>
            )}

            {/* Configurações Tab */}
            {activeTab === "configuracoes" && (
              <div className="space-y-6">
                <h2 className="text-3xl font-bold text-white">
                  Configurações do Sistema
                </h2>

                {/* Error Boundary para configurações */}
                <div className="bg-yellow-900/20 border border-yellow-500/50 p-4 rounded-lg">
                  <div className="flex items-center space-x-2">
                    <AlertTriangle className="w-5 h-5 text-yellow-400" />
                    <div>
                      <div className="text-yellow-400 font-medium">⚠️ Área em Manutenção</div>
                      <div className="text-yellow-300 text-sm">
                        As configurações estão temporariamente indisponíveis devido a atualizações do sistema.
                        Use as novas abas "Funcionários" e "Ponto Automático" para gerenciar o sistema.
                      </div>
                    </div>
                  </div>
                  
                  <div className="mt-4 flex space-x-2">
                    <Button
                      onClick={() => setActiveTab("funcionarios")}
                      className="bg-blue-600 hover:bg-blue-700"
                    >
                      <Users className="w-4 h-4 mr-2" />
                      Ir para Funcionários
                    </Button>
                    <Button
                      onClick={() => setActiveTab("auto-ponto")}
                      className="bg-green-600 hover:bg-green-700"
                    >
                      <Clock className="w-4 h-4 mr-2" />
                      Ir para Ponto Automático
                    </Button>
                  </div>
                </div>
              </div>
            )}

            {/* Área do Cliente Tab */}
            {activeTab === "area-cliente" && (
              <div className="space-y-6">
                <ClientAreaManager />
              </div>
            )}

            {/* Outras abas continuam aqui normalmente */}
                      variant="ghost"
                      className={`pb-3 px-0 rounded-none border-b-2 ${
                        activeSettingsTab === "usuarios"
                          ? "border-cinema-yellow text-cinema-yellow"
                          : "border-transparent text-gray-400 hover:text-white"
                      }`}
                      onClick={() => setActiveSettingsTab("usuarios")}
                    >
                      <Users className="w-4 h-4 mr-2" />
                      Usu��rios
                    </Button>
                    <Button
                      variant="ghost"
                      className={`pb-3 px-0 rounded-none border-b-2 ${
                        activeSettingsTab === "seguranca"
                          ? "border-cinema-yellow text-cinema-yellow"
                          : "border-transparent text-gray-400 hover:text-white"
                      }`}
                      onClick={() => setActiveSettingsTab("seguranca")}
                    >
                      <Shield className="w-4 h-4 mr-2" />
                      Segurança
                    </Button>
                    <Button
                      variant="ghost"
                      className={`pb-3 px-0 rounded-none border-b-2 ${
                        activeSettingsTab === "funcoes"
                          ? "border-cinema-yellow text-cinema-yellow"
                          : "border-transparent text-gray-400 hover:text-white"
                      }`}
                      onClick={() => setActiveSettingsTab("funcoes")}
                    >
                      <Package className="w-4 h-4 mr-2" />
                      Funções
                    </Button>
                    <Button
                      variant="ghost"
                      className={`pb-3 px-0 rounded-none border-b-2 ${
                        activeSettingsTab === "cores"
                          ? "border-cinema-yellow text-cinema-yellow"
                          : "border-transparent text-gray-400 hover:text-white"
                      }`}
                      onClick={() => setActiveSettingsTab("cores")}
                    >
                      <Palette className="w-4 h-4 mr-2" />
                      Temas
                    </Button>
                  </nav>
                </div>

                {/* Geral Tab */}
                {activeSettingsTab === "geral" && <CompanySettings />}

                {/* Usuários Tab */}
                {activeSettingsTab === "usuarios" && (
                  <div className="space-y-6">
                    <Card className="bg-cinema-gray border-cinema-gray-light">
                      <CardHeader>
                        <CardTitle className="text-white">
                          Usuários e Permissões
                        </CardTitle>
                      </CardHeader>
                      <CardContent className="space-y-4">
                        <div className="space-y-3">
                          <div className="flex justify-between items-center p-3 bg-cinema-dark-lighter rounded-lg">
                            <div>
                              <p className="text-white font-medium">
                                Admin Principal
                              </p>
                              <p className="text-gray-400 text-sm">
                                admin@bilscinema.com
                              </p>
                            </div>
                            <span className="text-cinema-yellow text-xs px-2 py-1 bg-cinema-yellow/20 rounded">
                              Administrador
                            </span>
                          </div>

                          <div className="flex justify-between items-center p-3 bg-cinema-dark-lighter rounded-lg">
                            <div>
                              <p className="text-white font-medium">
                                Funcionário 1
                              </p>
                              <p className="text-gray-400 text-sm">
                                func1@bilscinema.com
                              </p>
                            </div>
                            <span className="text-gray-400 text-xs px-2 py-1 bg-gray-400/20 rounded">
                              Operador
                            </span>
                          </div>
                        </div>

                        <Button
                          className="w-full text-cinema-yellow border-cinema-yellow"
                          variant="outline"
                        >
                          <Users className="w-4 h-4 mr-2" />
                          Gerenciar Usuários
                        </Button>
                      </CardContent>
                    </Card>
                  </div>
                )}

                {/* Segurança Tab */}
                {activeSettingsTab === "seguranca" && (
                  <div className="space-y-6">
                    <Card className="bg-cinema-gray border-cinema-gray-light">
                      <CardHeader>
                        <CardTitle className="text-white">Segurança</CardTitle>
                      </CardHeader>
                      <CardContent>
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                          <div className="flex items-center justify-between p-4 bg-cinema-dark-lighter rounded-lg">
                            <div className="flex items-center space-x-3">
                              <Shield className="w-5 h-5 text-cinema-yellow" />
                              <div>
                                <h4 className="text-white font-medium">
                                  Autenticação 2FA
                                </h4>
                                <p className="text-gray-400 text-sm">
                                  Segurança adicional para login
                                </p>
                              </div>
                            </div>
                            <Button
                              variant="outline"
                              className="text-cinema-yellow border-cinema-yellow"
                            >
                              Ativar
                            </Button>
                          </div>

                          <div className="flex items-center justify-between p-4 bg-cinema-dark-lighter rounded-lg">
                            <div className="flex items-center space-x-3">
                              <Bell className="w-5 h-5 text-cinema-yellow" />
                              <div>
                                <h4 className="text-white font-medium">
                                  Log de Atividades
                                </h4>
                                <p className="text-gray-400 text-sm">
                                  Registrar todas as ações
                                </p>
                              </div>
                            </div>
                            <Button
                              variant="outline"
                              className="text-cinema-yellow border-cinema-yellow"
                            >
                              Ativo
                            </Button>
                          </div>
                        </div>
                      </CardContent>
                    </Card>
                  </div>
                )}

                {/* Funções Tab */}
                {activeSettingsTab === "funcoes" && (
                  <div className="space-y-6">
                    <Card className="bg-cinema-gray border-cinema-gray-light">
                      <CardHeader>
                        <CardTitle className="text-white">
                          Funções do Sistema
                        </CardTitle>
                        <p className="text-gray-400 text-sm">
                          Funções integradas com backend para automatização e
                          operações avançadas
                        </p>
                      </CardHeader>
                      <CardContent className="space-y-6">
                        {/* Function Categories */}
                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                          {/* Cliente Functions */}
                          <div className="space-y-3">
                            <h4 className="text-cinema-yellow font-semibold text-sm border-b border-cinema-gray-light pb-2">
                              CLIENTES
                            </h4>
                            <div className="space-y-2">
                              <Button
                                variant="outline"
                                className="w-full justify-start text-left text-white border-cinema-gray-light hover:bg-cinema-yellow hover:text-cinema-dark"
                                onClick={() =>
                                  alert(
                                    "Função: Importar Clientes - Backend será implementado",
                                  )
                                }
                              >
                                <Users className="w-4 h-4 mr-2" />
                                Importar Clientes
                              </Button>
                              <Button
                                variant="outline"
                                className="w-full justify-start text-left text-white border-cinema-gray-light hover:bg-cinema-yellow hover:text-cinema-dark"
                                onClick={() =>
                                  alert(
                                    "Função: Sincronizar CRM - Backend será implementado",
                                  )
                                }
                              >
                                <Upload className="w-4 h-4 mr-2" />
                                Sincronizar CRM
                              </Button>
                              <Button
                                variant="outline"
                                className="w-full justify-start text-left text-white border-cinema-gray-light hover:bg-cinema-yellow hover:text-cinema-dark"
                                onClick={() =>
                                  alert(
                                    "Função: Validar CPF/CNPJ - Backend será implementado",
                                  )
                                }
                              >
                                <Shield className="w-4 h-4 mr-2" />
                                Validar CPF/CNPJ
                              </Button>
                            </div>
                          </div>

                          {/* Produto Functions */}
                          <div className="space-y-3">
                            <h4 className="text-cinema-yellow font-semibold text-sm border-b border-cinema-gray-light pb-2">
                              PRODUTOS
                            </h4>
                            <div className="space-y-2">
                              <Button
                                variant="outline"
                                className="w-full justify-start text-left text-white border-cinema-gray-light hover:bg-cinema-yellow hover:text-cinema-dark"
                                onClick={() =>
                                  alert(
                                    "Função: Importar Produtos - Backend será implementado",
                                  )
                                }
                              >
                                <Package className="w-4 h-4 mr-2" />
                                Importar Produtos
                              </Button>
                              <Button
                                variant="outline"
                                className="w-full justify-start text-left text-white border-cinema-gray-light hover:bg-cinema-yellow hover:text-cinema-dark"
                                onClick={() =>
                                  alert(
                                    "Função: Atualizar Preços - Backend será implementado",
                                  )
                                }
                              >
                                <DollarSign className="w-4 h-4 mr-2" />
                                Atualizar Preços
                              </Button>
                              <Button
                                variant="outline"
                                className="w-full justify-start text-left text-white border-cinema-gray-light hover:bg-cinema-yellow hover:text-cinema-dark"
                                onClick={() =>
                                  alert(
                                    "Função: Verificar Estoque - Backend será implementado",
                                  )
                                }
                              >
                                <AlertTriangle className="w-4 h-4 mr-2" />
                                Verificar Estoque
                              </Button>
                            </div>
                          </div>

                          {/* Locação Functions */}
                          <div className="space-y-3">
                            <h4 className="text-cinema-yellow font-semibold text-sm border-b border-cinema-gray-light pb-2">
                              LOCAÇÕES
                            </h4>
                            <div className="space-y-2">
                              <Button
                                variant="outline"
                                className="w-full justify-start text-left text-white border-cinema-gray-light hover:bg-cinema-yellow hover:text-cinema-dark"
                                onClick={() =>
                                  alert(
                                    "Função: Processar Devoluções - Backend será implementado",
                                  )
                                }
                              >
                                <ArrowRight className="w-4 h-4 mr-2" />
                                Processar Devoluções
                              </Button>
                              <Button
                                variant="outline"
                                className="w-full justify-start text-left text-white border-cinema-gray-light hover:bg-cinema-yellow hover:text-cinema-dark"
                                onClick={() =>
                                  alert(
                                    "Função: Calcular Multas - Backend será implementado",
                                  )
                                }
                              >
                                <Calculator className="w-4 h-4 mr-2" />
                                Calcular Multas
                              </Button>
                              <Button
                                variant="outline"
                                className="w-full justify-start text-left text-white border-cinema-gray-light hover:bg-cinema-yellow hover:text-cinema-dark"
                                onClick={() =>
                                  alert(
                                    "Função: Gerar Relatórios - Backend será implementado",
                                  )
                                }
                              >
                                <FileText className="w-4 h-4 mr-2" />
                                Gerar Relatórios
                              </Button>
                            </div>
                          </div>

                          {/* Financeiro Functions */}
                          <div className="space-y-3">
                            <h4 className="text-cinema-yellow font-semibold text-sm border-b border-cinema-gray-light pb-2">
                              FINANCEIRO
                            </h4>
                            <div className="space-y-2">
                              <Button
                                variant="outline"
                                className="w-full justify-start text-left text-white border-cinema-gray-light hover:bg-cinema-yellow hover:text-cinema-dark"
                                onClick={() =>
                                  alert(
                                    "Função: Processar Pagamentos - Backend será implementado",
                                  )
                                }
                              >
                                <DollarSign className="w-4 h-4 mr-2" />
                                Processar Pagamentos
                              </Button>
                              <Button
                                variant="outline"
                                className="w-full justify-start text-left text-white border-cinema-gray-light hover:bg-cinema-yellow hover:text-cinema-dark"
                                onClick={() =>
                                  alert(
                                    "Função: Gerar Boletos - Backend será implementado",
                                  )
                                }
                              >
                                <FileText className="w-4 h-4 mr-2" />
                                Gerar Boletos
                              </Button>
                              <Button
                                variant="outline"
                                className="w-full justify-start text-left text-white border-cinema-gray-light hover:bg-cinema-yellow hover:text-cinema-dark"
                                onClick={() =>
                                  alert(
                                    "Função: Conciliação Bancária - Backend será implementado",
                                  )
                                }
                              >
                                <TrendingUp className="w-4 h-4 mr-2" />
                                Conciliação Bancária
                              </Button>
                            </div>
                          </div>

                          {/* Integração Functions */}
                          <div className="space-y-3">
                            <h4 className="text-cinema-yellow font-semibold text-sm border-b border-cinema-gray-light pb-2">
                              INTEGRAÇÕES
                            </h4>
                            <div className="space-y-2">
                              <Button
                                variant="outline"
                                className="w-full justify-start text-left text-white border-cinema-gray-light hover:bg-cinema-yellow hover:text-cinema-dark"
                                onClick={() =>
                                  alert(
                                    "Função: Sincronizar Sistema - Backend será implementado",
                                  )
                                }
                              >
                                <Upload className="w-4 h-4 mr-2" />
                                Sincronizar Sistema
                              </Button>
                              <Button
                                variant="outline"
                                className="w-full justify-start text-left text-white border-cinema-gray-light hover:bg-cinema-yellow hover:text-cinema-dark"
                                onClick={() =>
                                  alert(
                                    "Função: Backup Automático - Backend será implementado",
                                  )
                                }
                              >
                                <Download className="w-4 h-4 mr-2" />
                                Backup Automático
                              </Button>
                              <Button
                                variant="outline"
                                className="w-full justify-start text-left text-white border-cinema-gray-light hover:bg-cinema-yellow hover:text-cinema-dark"
                                onClick={() =>
                                  alert(
                                    "Função: API Webhook - Backend será implementado",
                                  )
                                }
                              >
                                <Monitor className="w-4 h-4 mr-2" />
                                API Webhook
                              </Button>
                            </div>
                          </div>

                          {/* Automação Functions */}
                          <div className="space-y-3">
                            <h4 className="text-cinema-yellow font-semibold text-sm border-b border-cinema-gray-light pb-2">
                              AUTOMAÇÃO
                            </h4>
                            <div className="space-y-2">
                              <Button
                                variant="outline"
                                className="w-full justify-start text-left text-white border-cinema-gray-light hover:bg-cinema-yellow hover:text-cinema-dark"
                                onClick={() =>
                                  alert(
                                    "Função: Envio de Email - Backend será implementado",
                                  )
                                }
                              >
                                <Bell className="w-4 h-4 mr-2" />
                                Envio de Email
                              </Button>
                              <Button
                                variant="outline"
                                className="w-full justify-start text-left text-white border-cinema-gray-light hover:bg-cinema-yellow hover:text-cinema-dark"
                                onClick={() =>
                                  alert(
                                    "Função: Notificações SMS - Backend será implementado",
                                  )
                                }
                              >
                                <Phone className="w-4 h-4 mr-2" />
                                Notificações SMS
                              </Button>
                              <Button
                                variant="outline"
                                className="w-full justify-start text-left text-white border-cinema-gray-light hover:bg-cinema-yellow hover:text-cinema-dark"
                                onClick={() =>
                                  alert(
                                    "Função: Tarefas Agendadas - Backend será implementado",
                                  )
                                }
                              >
                                <Clock className="w-4 h-4 mr-2" />
                                Tarefas Agendadas
                              </Button>
                            </div>
                          </div>
                        </div>

                        <Separator className="bg-cinema-gray-light" />

                        {/* Implementation Status */}
                        <div className="bg-cinema-dark-lighter rounded-lg p-4">
                          <h4 className="text-cinema-yellow font-semibold mb-3">
                            Status da Implementação
                          </h4>
                          <div className="space-y-2">
                            <div className="flex justify-between items-center">
                              <span className="text-white text-sm">
                                Interface Frontend:
                              </span>
                              <span className="text-green-400 text-sm flex items-center">
                                <CheckCircle className="w-4 h-4 mr-1" />
                                Concluída
                              </span>
                            </div>
                            <div className="flex justify-between items-center">
                              <span className="text-white text-sm">
                                Backend Functions:
                              </span>
                              <span className="text-yellow-400 text-sm flex items-center">
                                <Clock className="w-4 h-4 mr-1" />
                                Aguardando implementação
                              </span>
                            </div>
                            <div className="flex justify-between items-center">
                              <span className="text-white text-sm">
                                Integração com Cursor:
                              </span>
                              <span className="text-cinema-yellow text-sm flex items-center">
                                <Star className="w-4 h-4 mr-1" />
                                Pronta para código
                              </span>
                            </div>
                          </div>
                          <div className="mt-4 p-3 bg-cinema-gray rounded border border-cinema-yellow/30">
                            <p className="text-cinema-yellow text-sm font-medium mb-1">
                              💡 Próximo Passo:
                            </p>
                            <p className="text-gray-300 text-sm">
                              Cole o código das funções no Cursor para
                              implementar o backend. Cada botão acima está
                              preparado para receber sua respectiva função.
                            </p>
                          </div>
                        </div>
                      </CardContent>
                    </Card>
                  </div>
                )}

                {/* Temas Tab */}
                {activeSettingsTab === "cores" && <ColorSettings />}
                    </div>
                  </div>
                )}
              </div>
            )}

            {/* Área do Cliente Tab */}
            {activeTab === "area-cliente" && (
              <div className="space-y-6">
                <ClientAreaManager />
              </div>
            )}
          </div>
        </div>

        {/* Product Selection Modal */}
        <ProductSelectionModal
          isOpen={showProductSelectionModal}
          onClose={() => setShowProductSelectionModal(false)}
          onSelectProducts={handleProductSelection}
          existingProducts={newOrderForm.equipment || []}
        />
      </div>
    </Layout>
  );
}
